<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"iiishop.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-1}},"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta name="description" content="Introduce In our recent game production experience, we often faced the problem of excessive memory consumption. For example, when pressed Shift kay, the player can get a high speed, and some shadow wi"><meta property="og:type" content="article"><meta property="og:title" content="ObjectPool"><meta property="og:url" content="http://iiishop.github.io/2023/03/30/ObjectPool/index.html"><meta property="og:site_name" content="iiishop&#39;s blog"><meta property="og:description" content="Introduce In our recent game production experience, we often faced the problem of excessive memory consumption. For example, when pressed Shift kay, the player can get a high speed, and some shadow wi"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2023-03-30T12:00:40.000Z"><meta property="article:modified_time" content="2023-04-17T01:10:24.829Z"><meta property="article:author" content="iiishop"><meta property="article:tag" content="Unity"><meta property="article:tag" content="Design Pattern"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://iiishop.github.io/2023/03/30/ObjectPool/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://iiishop.github.io/2023/03/30/ObjectPool/","path":"2023/03/30/ObjectPool/","title":"ObjectPool"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ObjectPool | iiishop's blog</title><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?1d328bf67c2cfa768a4fb1fc80a02a5c"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style><link rel="alternate" href="/atom.xml" title="iiishop's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">iiishop's blog</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div><canvas id="canvas" style="width:60%">当前浏览器不支持canvas，请更换浏览器后再试</canvas></div><script>!function(){var h,o,r,f,t,e,d=[[[0,0,1,1,1,0,0],[0,1,1,0,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1,0],[0,0,1,1,1,0,0]],[[0,0,0,1,1,0,0],[0,1,1,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[1,1,1,1,1,1,1]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,0,0,1,1],[1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,1,1,0,1,1,0],[1,1,0,0,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,1]],[[1,1,1,1,1,1,1],[1,1,0,0,0,0,0],[1,1,0,0,0,0,0],[1,1,1,1,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[1,1,1,1,1,1,1],[1,1,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,1,1,0,0,0,0]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]]],i=document.getElementById("canvas");function a(t,e){for(var l=[1,2,3],n=["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"],a=0;a<d[e].length;a++)for(var h,o=0;o<d[e][a].length;o++)1==d[e][a][o]&&(h={x:14*(f+2)*t+2*o*(f+1)+(f+1),y:2*a*(f+1)+(f+1),stepX:Math.floor(4*Math.random()-2),stepY:-2*l[Math.floor(Math.random()*l.length)],color:n[Math.floor(Math.random()*n.length)],disY:1},r.push(h))}function l(){i.height=100;for(var t=0;t<o.length;t++){a=n=l=e=void 0;for(var e=t,l=o[t],n=0;n<d[l].length;n++)for(var a=0;a<d[l][n].length;a++)1==d[l][n][a]&&(h.beginPath(),h.arc(14*(f+2)*e+2*a*(f+1)+(f+1),2*n*(f+1)+(f+1),f,0,2*Math.PI),h.closePath(),h.fill())}for(t=0;t<r.length;t++)h.beginPath(),h.arc(r[t].x,r[t].y,f,0,2*Math.PI),h.fillStyle=r[t].color,h.closePath(),h.fill()}i.getContext&&(h=i.getContext("2d"),i.height=100,i.width=700,h.fillStyle="#f00",h.fillRect(10,10,50,50),o=[],r=[],f=i.height/20-1,e=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date),o.push(e[1],e[2],10,e[3],e[4],10,e[5],e[6]),clearInterval(t),t=setInterval(function(){!function(){var t=[],e=/(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date),l=[];l.push(e[1],e[2],10,e[3],e[4],10,e[5],e[6]);for(var n=o.length-1;0<=n;n--)l[n]!==o[n]&&t.push(n+"_"+(Number(o[n])+1)%10);for(n=0;n<t.length;n++)a.apply(this,t[n].split("_"));o=l.concat()}();for(var t=0;t<r.length;t++)r[t].stepY+=r[t].disY,r[t].x+=r[t].stepX,r[t].y+=r[t].stepY,(r[t].x>700+f||r[t].y>100+f)&&(r.splice(t,1),t--);l()},50))}()</script><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#introduce"><span class="nav-number">1.</span> <span class="nav-text">Introduce</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#background"><span class="nav-number">2.</span> <span class="nav-text">Background</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-is-objectpool"><span class="nav-number">2.1.</span> <span class="nav-text">What is ObjectPool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#why-objectpool-can-solve-this-problem"><span class="nav-number">2.2.</span> <span class="nav-text">Why ObjectPool can solve this problem</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#structure"><span class="nav-number">3.</span> <span class="nav-text">Structure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#variables"><span class="nav-number">4.</span> <span class="nav-text">Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#instance"><span class="nav-number">4.1.</span> <span class="nav-text">Instance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pool_size"><span class="nav-number">4.2.</span> <span class="nav-text">Pool_Size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#prefabs"><span class="nav-number">4.3.</span> <span class="nav-text">Prefabs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#available_objects_dictionary"><span class="nav-number">4.4.</span> <span class="nav-text">Available_Objects_Dictionary</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#functions"><span class="nav-number">5.</span> <span class="nav-text">Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#awake"><span class="nav-number">5.1.</span> <span class="nav-text">Awake</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fillpool"><span class="nav-number">5.2.</span> <span class="nav-text">FillPool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#returnpool"><span class="nav-number">5.3.</span> <span class="nav-text">ReturnPool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getpool"><span class="nav-number">5.4.</span> <span class="nav-text">GetPool</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#improvment"><span class="nav-number">6.</span> <span class="nav-text">Improvment</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#conclusion"><span class="nav-number">7.</span> <span class="nav-text">Conclusion</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="iiishop" src="/images/loading.gif" data-original="/images/head.png"><p class="site-author-name" itemprop="name">iiishop</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/iiishop" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;iiishop" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://steamcommunity.com/id/iiishop" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;iiishop" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/34841715" title="bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;34841715" rel="noopener" target="_blank"><i class="fab fa-bilibili fa-fw"></i>bilibili</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/loading.gif" data-original="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="http://iiishop.github.io/2023/03/30/ObjectPool/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.png"><meta itemprop="name" content="iiishop"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="iiishop's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ObjectPool | iiishop's blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">ObjectPool</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2023-03-30 20:00:40" itemprop="dateCreated datePublished" datetime="2023-03-30T20:00:40+08:00">2023-03-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-04-17 09:10:24" itemprop="dateModified" datetime="2023-04-17T09:10:24+08:00">2023-04-17</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/EnglishBlog/" itemprop="url" rel="index"><span itemprop="name">EnglishBlog</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/EnglishBlog/Design-Pattern/" itemprop="url" rel="index"><span itemprop="name">Design Pattern</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="introduce">Introduce</h1><p>In our recent game production experience, we often faced the problem of excessive memory consumption.<br>For example, when pressed Shift kay, the player can get a high speed, and some shadow will appear in the path. If we instantiate and destory the shadow object every time, the memory will be greatly wasted. So, we need to use <code>ObjectPool</code> to deal with this situation.<br><span id="more"></span></p><h1 id="background">Background</h1><p>In this section, we will discuss what is <code>ObjectPool</code>, and why <code>ObjectPool</code> can solve this problem.</p><ul><li><h2 id="what-is-objectpool">What is <code>ObjectPool</code></h2><p>Interpret it literally, ObjectPool is a pool filled with objects. Then we can get or return the object from this pool.</p></li><li><h2 id="why-objectpool-can-solve-this-problem">Why <code>ObjectPool</code> can solve this problem</h2><p>The worest part of the <strong>Instantiate-Destory</strong> way is it applied and used the memory for only a while before it was discarded. So, when we use the ObjectPool pattern, everything that only be used a while will be created in the pool for preparation.</p><p>Now, we built and changed to use the ObjectPool pattern. The objects we need to use are already created in the pool. When we need the object, we only need to get from the pool, then return into the pool.</p></li></ul><p>In the next section, I will show the structure of ObjectPool.</p><h1 id="structure">Structure</h1><ul><li>Design Pattern: <strong>Signleton</strong></li><li>Variables:<ol type="1"><li><strong><em>static</em></strong> ObjectPool <strong>Instance</strong></li><li>int <strong>Pool_Size</strong></li><li>List&lt;GameObject&gt; <strong>Prefabs</strong> <strong><em>//Because I use the ObjectPool in Unity, you can use other type.</em></strong></li><li>Dictionary&lt;string, Queue&lt;GameObject&gt;&gt; <strong>Available_Objects_Dictionary</strong></li></ol></li><li>Functions:<ol type="1"><li>void <strong>Awake</strong>()</li><li>void <strong>FillPool</strong>()</li><li>void <strong>ReturnPool</strong>()</li><li>GameObject <strong>GetPool</strong>()</li></ol></li></ul><h1 id="variables">Variables</h1><ul><li><h2 id="instance">Instance</h2>Instance is a instance of ObjectPool class, we will access this variable in other script to use the ObjectPool.</li><li><h2 id="pool_size">Pool_Size</h2>Pool_Size is the basic size of the ObjectPool, all objects will be created in size copies in the pool at script awake.<br></li><li><h2 id="prefabs">Prefabs</h2>Prefabs can be added at the Unity Interface, and they will be created in the pool.</li><li><h2 id="available_objects_dictionary">Available_Objects_Dictionary</h2>This variable is the most important part, it can allow we to invoke the ObjectPool by the name of object. The value of the dictionary is a queue, it is the main part of the ObjectPool or we can call this is the pool. Every object will be stored in this queue.</li></ul><h1 id="functions">Functions</h1><ul><li><h2 id="awake">Awake</h2><p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Instance <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> Instance <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        Instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">FillPool</span><span class="token punctuation">(</span>Pool_Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>Awake</code> is the standard part of a Signleton class, it is used to be sure the program only has one instance. When the instance is not the first instance, it will kill the instance. And if it is, this function will invoke <code>FillPool</code>.</p></li><li><h2 id="fillpool">FillPool</h2><p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FillPool</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> Size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> Prefab <span class="token keyword">in</span> Prefabs<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> <span class="token function">instantiate</span><span class="token punctuation">(</span>Prefab<span class="token punctuation">,</span> transform<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ReturnPool</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>FillPool</code> will fill the pool by evey prefab in the Prefabs. It will invoke <code>ReturnPool</code> to do a standard process to return the object into the pool.</p></li><li><h2 id="returnpool">ReturnPool</h2><p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReturnPool</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> Object<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Available_Objects_Dictionary<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Available_Objects_Dictionary<span class="token punctuation">[</span>Object<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        Available_Objects_Dictionary<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Queue<span class="token punctuation">&lt;</span>GameObject<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Available_Objects_Dictionary<span class="token punctuation">[</span>Object<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><code>ReturnPool</code> will put the object into the corresponding pool, if the pool does not exist, it will create one first.</p></li><li><h2 id="getpool">GetPool</h2><p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">GameObject</span> <span class="token function">GetPool</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> Object<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> NAME <span class="token operator">=</span> Object<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"(Clone)"</span><span class="token punctuation">;</span> <span class="token comment">//Because Unity will add "(Clone)" in the end of the instantiated prefabs</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Available_Objects_Dictionary<span class="token punctuation">[</span>NAME<span class="token punctuation">]</span><span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">FillPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> Available_Objects_Dictionary<span class="token punctuation">[</span>NAME<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><code>GetPool</code> will be sure you can get a object from the pool. When there are no object in the pool, it will fill one into the pool.</p></li></ul><h1 id="improvment">Improvment</h1><p>Now, we have the fundamental ObjectPool instance, we can use it to reuse our objects already created in scene. But it still have something can be improved, the most obvious one is the <code>FillPool</code> method.</p><p>When invoke the <code>FillPool</code> method, it will fill the pool with a <code>Size</code> number of objects. It looks right when our objects needed all in a controllable small range of quantities. But when we need to use a large number of one type objects a short time, the other objects created as foils are wasted.</p><p>To solve this problem, we only need to add a <code>Prefabs</code> parameter to the <code>FillPool</code> method in order to designate what prefabs need to be fill into the pool.</p><p>The improved <code>FillPool</code> method will be looked like as this<br><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FillPool</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> Size<span class="token punctuation">,</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>GameObject<span class="token punctuation">&gt;</span></span> Prefabs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> Prefab <span class="token keyword">in</span> Prefabs<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> <span class="token function">instantiate</span><span class="token punctuation">(</span>Prefab<span class="token punctuation">,</span> transform<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ReturnPool</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>and the <code>GetPool</code> method need to be improved like this<br><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">GameObject</span> <span class="token function">GetPool</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> Object<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> NAME <span class="token operator">=</span> Object<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"(Clone)"</span><span class="token punctuation">;</span> <span class="token comment">//Because Unity will add "(Clone)" in the end of the instantiated prefabs</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Available_Objects_Dictionary<span class="token punctuation">[</span>NAME<span class="token punctuation">]</span><span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">FillPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>GameObject<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Object<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> Available_Objects_Dictionary<span class="token punctuation">[</span>NAME<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>meanwhile, the <code>Awake</code> also need to be improved like this<br><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Instance <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> Instance <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        Instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">FillPool</span><span class="token punctuation">(</span>Pool_Size<span class="token punctuation">,</span> Prefabs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>Now, when we use the <code>GetPool</code> to get a object from pool, it will only create one object in the pool when this type of object is empty in the pool.</p><h1 id="conclusion">Conclusion</h1><p>We have implement a ObjectPool in the steps above. The pool can store and release the GameObject, and we can use this to save memory in the bullet script or other same function scropt. But this class also have some inconvenience, that is we can only use it as a GameObject pool, if we want to store another type, we need to create another class of object. About how to solve it to make the ObjectPool generalization, it is your thinking homework. I may put the method in another post.</p></div><footer class="post-footer"><div class="reward-container"><div>Buy me a coffee</div><button>Donate</button><div class="post-reward"></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>Post author: </strong>iiishop</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://iiishop.github.io/2023/03/30/ObjectPool/" title="ObjectPool">http://iiishop.github.io/2023/03/30/ObjectPool/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"><span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><div class="post-tags"><a href="/tags/Unity/" rel="tag"><i class="fa fa-tag"></i> Unity</a> <a href="/tags/Design-Pattern/" rel="tag"><i class="fa fa-tag"></i> Design Pattern</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2023/02/02/%E5%BF%83%E7%81%B5%E8%BF%B7%E5%AE%AB-%E6%A1%86%E6%9E%B6/" rel="prev" title="心灵迷宫_框架"><i class="fa fa-chevron-left"></i> 心灵迷宫_框架</a></div><div class="post-nav-item"><a href="/2023/04/04/%E6%8F%90%E9%97%AE%E7%9A%84%E6%99%BA%E6%85%A7/" rel="next" title="提问的智慧">提问的智慧 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">iiishop</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.7/mermaid.min.js","integrity":"sha256-G58AID1YoX5YaEtWfXSI0VLrZ6N4kvNvwg0BI8zUFxE="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"iiishop/iiishop.github.io","issue_term":"pathname","theme":"github-light"}</script><script src="/js/third-party/comments/utterances.js"></script><script src="/js/love.js"></script><script src="/js/sakura.js"></script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(e){e.imageLazyLoadSetting.processImages=t;var n=e.imageLazyLoadSetting.isSPA,i=e.imageLazyLoadSetting.preloadRatio||1,r=o();function o(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){n&&(r=o());for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(e.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];e=function(){r=r.filter(function(t){return o!==t})},(t=o).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,t.removeAttribute("data-original"),e&&e()},t.src!==i&&(n.src=i))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),e.addEventListener("resize",a),e.addEventListener("orientationchange",a)}(this);</script></body></html>