const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-SteamGameBlock-B49H3P1a.js","assets/entry-index-iVSCK1fB.js","assets/chunk-mermaid-lib-CtMrMl2-.js","assets/asset-index-DQTw5x8l.css","assets/chunk-color-thief-DF3QbzqH.js","assets/chunk-_plugin-vue_export-helper-DlAUqK2U.js","assets/asset-SteamGameBlock-B-ltQF1U.css","assets/chunk-BangumiBlock-0xSVlkuw.js","assets/asset-BangumiBlock-CZgwujlY.css","assets/chunk-BilibiliVideoBlock-utCssGwA.js","assets/asset-BilibiliVideoBlock-DE3SKqHY.css","assets/chunk-GithubRepoBlock-CV0KppWQ.js","assets/asset-GithubRepoBlock-CkND9FTr.css","assets/chunk-XiaohongshuNoteBlock-DdAu2nZK.js","assets/asset-XiaohongshuNoteBlock-C8nWHP7E.css"])))=>i.map(i=>d[i]);
import{an as me,_ as O}from"./chunk-mermaid-lib-CtMrMl2-.js";import ye from"./chunk-BaseLayout-IT93BI8K.js";import we from"./chunk-WaterfallPanel-Cb3yktym.js";import{r as m,i as T,A as re,f as fe,j as be,c as ge,o as b,b as P,q as A,e,a as ce,l as ke,t as w,x as ie,w as ve,G as xe,D as Me,I as _e,J as Ie,n as ae,d as X,F as Pe}from"./entry-index-iVSCK1fB.js";import{m as he}from"./chunk-MarkdownRenender-B6HGnk-U.js";import{r as Ce}from"./chunk-DynamicComponentRenderer-8lJX96iq.js";import{_ as pe}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import{f as We}from"./chunk-index-Dy4cVkSp.js";import"./chunk-index-D-nlVayj.js";const De={class:"modal-image-section"},Le=["src","alt"],Ee={class:"image-info-float"},Be={class:"image-dimensions"},Te={class:"image-format"},Se={class:"image-zoom"},Re={class:"image-toolbar"},$e={class:"toolbar-group"},Fe={class:"zoom-text"},Oe={class:"toolbar-group"},Ae={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},He={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ne={key:0,class:"image-info-panel"},Ve={class:"info-item"},Ge={class:"info-value"},je={class:"info-item"},Ue={class:"info-value"},Xe={class:"info-item"},ze={class:"info-value"},Ye={class:"info-item"},qe={class:"info-value"},Ke={class:"info-item"},Qe={class:"info-value"},Je={class:"info-item"},Ze={class:"info-value"},et={key:0,class:"modal-description-section"},tt=["innerHTML"],at={__name:"ImageModal",props:{image:{type:Object,required:!0},description:{type:String,default:""},triggerCardRect:{type:Object,default:null},images:{type:Array,default:()=>[]},currentIndex:{type:Number,default:0}},emits:["close","next","prev"],setup(S,{emit:R}){const H=X(()=>O(()=>import("./chunk-SteamGameBlock-B49H3P1a.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),$=X(()=>O(()=>import("./chunk-BangumiBlock-0xSVlkuw.js"),__vite__mapDeps([7,1,2,3,4,5,8]))),x=X(()=>O(()=>import("./chunk-BilibiliVideoBlock-utCssGwA.js"),__vite__mapDeps([9,1,2,3,5,10]))),z=X(()=>O(()=>import("./chunk-GithubRepoBlock-CV0KppWQ.js"),__vite__mapDeps([11,1,2,3,5,12]))),N=X(()=>O(()=>import("./chunk-XiaohongshuNoteBlock-DdAu2nZK.js"),__vite__mapDeps([13,1,2,3,5,14]))),c=S,V=R,G=m(null),Y=m(null),C=m(!1),p=m(""),f=m(1),W=m(0),D=m(0),L=m(0),M=m(!1),q=m(0),K=m(0),_=m(!1),F=m(!1),a=T(()=>c.image.width&&c.image.height?`${c.image.width} × ${c.image.height}`:""),n=T(()=>c.image.src?c.image.src.split(".").pop().toUpperCase():""),l=T(()=>({transform:`scale(${f.value}) rotate(${W.value}deg) translate(${D.value}px, ${L.value}px)`,cursor:f.value>1?M.value?"grabbing":"grab":"default",transition:M.value?"none":"transform 0.3s ease"})),o=T(()=>c.images&&c.images.length>1&&c.currentIndex>0),s=T(()=>c.images&&c.images.length>1&&c.currentIndex<c.images.length-1),i=T(()=>{const r=p.value||c.description;if(!r)return"";const t=r.trim().toLowerCase();if(t.startsWith("<!doctype")||t.startsWith("<html")||t.includes("<!doctype html>"))return console.warn("[ImageModal] Blocked HTML content from rendering"),"";let d=r;if(d.startsWith("---")){const h=d.indexOf("---",3);h!==-1&&(d=d.substring(h+3).trim())}return he.render(d)}),u=T(()=>{const r=p.value||c.description;if(!r)return!1;const t=r.trim().toLowerCase();return!(t.startsWith("<!doctype")||t.startsWith("<html")||t.includes("<!doctype html>"))});async function v(){if(!c.image.mdPath){p.value="";return}try{const r=await fetch(c.image.mdPath);if(!r.ok){console.log("[ImageModal] .md file not found (status:",r.status,")"),p.value="";return}if((r.headers.get("content-type")||"").includes("text/html")){console.log("[ImageModal] .md file not found (got HTML content-type)"),p.value="";return}const d=await r.text();if(!d||!d.trim()){console.log("[ImageModal] .md file is empty"),p.value="";return}const h=d.trim().toLowerCase();if(h.startsWith("<!doctype")||h.startsWith("<html")||h.includes("<!doctype html>")||h.includes("<html>")){console.log("[ImageModal] .md file not found (got HTML page)"),p.value="";return}p.value=d,console.log("[ImageModal] Successfully loaded .md file")}catch(r){console.log("[ImageModal] Failed to load markdown description:",r),p.value=""}}function g(){C.value=!1,E(),V("close")}function E(){f.value=1,W.value=0,D.value=0,L.value=0,M.value=!1}function j(){f.value=Math.min(f.value+.25,5)}function y(){f.value=Math.max(f.value-.25,.5)}function k(){f.value=1,D.value=0,L.value=0}function Q(){W.value-=90}function J(){W.value+=90}async function B(){try{const t=await(await fetch(c.image.src)).blob(),d=window.URL.createObjectURL(t),h=document.createElement("a");h.href=d,h.download=c.image.title||"image",document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(d)}catch(r){console.error("[ImageModal] Failed to download image:",r),alert("下载失败，请稍后重试")}}async function oe(){try{const r=window.location.origin+c.image.src;await navigator.clipboard.writeText(r),alert("✓ 图片链接已复制到剪贴板")}catch(r){console.error("[ImageModal] Failed to copy link:",r),alert("复制失败，请手动复制")}}function Z(){_.value=!_.value}function ee(){F.value=!F.value}function U(r){f.value<=1||(M.value=!0,q.value=r.clientX-D.value,K.value=r.clientY-L.value,r.preventDefault())}function I(r){M.value&&(D.value=r.clientX-q.value,L.value=r.clientY-K.value)}function te(){M.value=!1}function ne(){f.value===1?f.value=2:k()}function le(r){r.preventDefault();const t=r.deltaY>0?-.1:.1;f.value=Math.max(.5,Math.min(5,f.value+t))}function se(){o.value&&(E(),V("prev"))}function de(){s.value&&(E(),V("next"))}function ue(r){if(C.value)switch(r.key){case"Escape":g();break;case"ArrowLeft":se();break;case"ArrowRight":de();break;case"+":case"=":j();break;case"-":case"_":y();break;case"0":k();break;case"f":case"F":Z();break;case"i":case"I":ee();break;case"d":case"D":B();break}}return re(()=>c.image,r=>{r&&(C.value=!0,E(),v())},{immediate:!0}),re(C,r=>{r&&ae(()=>{G.value&&G.value.focus()})}),re(i,async()=>{await ae();const r=Y.value;if(r&&(Ce(r,{bilibilivideoblock:x,steamgameblock:H,bangumiblock:$,githubrepoblock:z,xiaohongshunoteblock:N}),await ae(),typeof me<"u"))try{await me.run({nodes:r.querySelectorAll(".mermaid")}),await ae(),r.querySelectorAll(".mermaid svg").forEach(d=>{d.removeAttribute("width"),d.removeAttribute("height"),d.style.width="100%",d.style.height="400px",d.style.maxWidth="100%",d.style.maxHeight="400px",d.style.display="block",d.style.margin="0 auto"})}catch(t){console.warn("[ImageModal] Mermaid rendering failed:",t)}}),fe(()=>{document.addEventListener("keydown",ue),v()}),be(()=>{document.removeEventListener("keydown",ue)}),(r,t)=>(b(),ge(Ie,{to:"body"},[C.value?(b(),P("div",{key:0,class:"image-modal",onClick:_e(g,["self"]),onKeydown:Me(g,["esc"]),tabindex:"0",ref_key:"modalRef",ref:G},[t[20]||(t[20]=e("div",{class:"modal-backdrop"},null,-1)),e("div",{class:ie(["modal-content",{"no-description":!u.value,"fullscreen-mode":_.value}])},[e("div",De,[e("div",{class:"image-container",onWheel:le},[e("img",{src:S.image.src,alt:S.image.alt,class:"modal-image",style:ke(l.value),onMousedown:U,onMousemove:I,onMouseup:te,onMouseleave:te,onDblclick:ne},null,44,Le),e("div",Ee,[e("span",Be,w(a.value),1),e("span",Te,w(n.value),1),e("span",Se,w(Math.round(f.value*100))+"%",1)])],32),e("div",Re,[e("div",$e,[e("button",{class:"toolbar-btn",onClick:y,title:"缩小 (-)"},t[0]||(t[0]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M8 11h6"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)])),e("button",{class:"toolbar-btn",onClick:k,title:"重置 (0)"},[e("span",Fe,w(Math.round(f.value*100))+"%",1)]),e("button",{class:"toolbar-btn",onClick:j,title:"放大 (+)"},t[1]||(t[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M11 8v6M8 11h6"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)]))]),e("div",{class:"toolbar-group"},[e("button",{class:"toolbar-btn",onClick:Q,title:"逆时针旋转"},t[2]||(t[2]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e("path",{d:"M3 3v5h5"})],-1)])),e("button",{class:"toolbar-btn",onClick:J,title:"顺时针旋转"},t[3]||(t[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}),e("path",{d:"M21 3v5h-5"})],-1)]))]),e("div",Oe,[e("button",{class:"toolbar-btn",onClick:B,title:"下载图片 (D)"},t[4]||(t[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])),e("button",{class:"toolbar-btn",onClick:oe,title:"复制链接"},t[5]||(t[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1)])),e("button",{class:ie(["toolbar-btn",{active:F.value}]),onClick:ee,title:"图片信息 (I)"},t[6]||(t[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1)]),2),e("button",{class:ie(["toolbar-btn",{active:_.value}]),onClick:Z,title:"图片全屏 (F)"},[_.value?(b(),P("svg",He,t[8]||(t[8]=[e("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"},null,-1)]))):(b(),P("svg",Ae,t[7]||(t[7]=[e("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"},null,-1)])))],2)])]),ce(xe,{name:"info-panel-fade"},{default:ve(()=>[F.value?(b(),P("div",Ne,[t[15]||(t[15]=e("h3",null,"图片信息",-1)),e("div",Ve,[t[9]||(t[9]=e("span",{class:"info-label"},"标题:",-1)),e("span",Ge,w(S.image.title||"无"),1)]),e("div",je,[t[10]||(t[10]=e("span",{class:"info-label"},"编辑日期:",-1)),e("span",Ue,w(S.image.date||"无"),1)]),e("div",Xe,[t[11]||(t[11]=e("span",{class:"info-label"},"尺寸:",-1)),e("span",ze,w(a.value||"未知"),1)]),e("div",Ye,[t[12]||(t[12]=e("span",{class:"info-label"},"格式:",-1)),e("span",qe,w(n.value),1)]),e("div",Ke,[t[13]||(t[13]=e("span",{class:"info-label"},"缩放:",-1)),e("span",Qe,w(Math.round(f.value*100))+"%",1)]),e("div",Je,[t[14]||(t[14]=e("span",{class:"info-label"},"旋转:",-1)),e("span",Ze,w(W.value)+"°",1)])])):A("",!0)]),_:1}),o.value?(b(),P("button",{key:0,class:"nav-btn nav-prev",onClick:se,title:"上一张 (←)"},t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)]))):A("",!0),s.value?(b(),P("button",{key:1,class:"nav-btn nav-next",onClick:de,title:"下一张 (→)"},t[17]||(t[17]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"9 18 15 12 9 6"})],-1)]))):A("",!0),e("button",{class:"close-btn",onClick:g,"aria-label":"Close modal"},t[18]||(t[18]=[e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))]),u.value&&!_.value?(b(),P("div",et,[t[19]||(t[19]=e("div",{class:"description-header"},[e("h2",{class:"description-title"},"图片描述")],-1)),e("div",{class:"description-content",ref_key:"contentRef",ref:Y},[e("div",{innerHTML:i.value,class:"markdown-body"},null,8,tt)],512)])):A("",!0)],2)],544)):A("",!0)]))}},ot=pe(at,[["__scopeId","data-v-a4736f1a"]]),nt={__name:"WaterfallPage",setup(S){const R=m(null),H=m([]),$=m(null),x=m(""),z=m(!1),N=m(null),c=[".png",".jpg",".jpeg",".gif",".webp",".svg",".avif"];async function V(){const a="/Posts/WaterfallGraph",n=[];try{return await G(a,n),console.log("[WaterfallPage] Scanned files:",n),n}catch(l){return console.error("[WaterfallPage] Error scanning directory:",l),[]}}async function G(a,n){try{const l=Object.assign({"/public/Posts/WaterfallGraph/QQ图片20241210012107.jpg":()=>O(()=>import("./chunk-QQ图片20241210012107-BHzg_r5M.js"),[]).then(o=>o.default)});console.log("[WaterfallPage] Image modules found:",Object.keys(l));for(const o in l){const s=o.replace("/public",""),i=s.split("/").pop(),u=s.substring(0,s.lastIndexOf("/"));n.push({path:s,name:i,directory:u,fullPath:o})}console.log("[WaterfallPage] Processed files:",n)}catch(l){console.error(`[WaterfallPage] Error scanning ${a}:`,l)}}function Y(a){const n=a.filter(l=>{const o=l.name.lastIndexOf(".");if(o===-1)return console.log(`[WaterfallPage] File has no extension: ${l.name}`),!1;const s="."+l.name.substring(o+1).toLowerCase(),i=c.includes(s);return console.log(`[WaterfallPage] File: ${l.name}, Extension: ${s}, Supported: ${i}`),i});return console.log("[WaterfallPage] Filtered images:",n),n}async function C(a){console.log("[WaterfallPage] Loading metadata for",a.length,"files");const n=a.map(async s=>{try{const i=await p(s.path),u=s.name.lastIndexOf("."),v=u>0?s.name.substring(0,u):s.name,g=D(s.path),j=L(s.name)||new Date().toISOString(),y=await f(i),k={id:g,src:s.path,alt:v,title:v,width:i.naturalWidth,height:i.naturalHeight,aspectRatio:i.naturalWidth/i.naturalHeight,dominantColor:y,date:j,tags:[],mdPath:s.path.replace(/\.[^.]+$/,".md"),hasDescription:!1,directory:s.directory,fileName:s.name};return console.log("[WaterfallPage] Loaded metadata for:",s.name,k),k}catch(i){return console.error(`[WaterfallPage] Failed to load metadata for ${s.path}:`,i),null}}),o=(await Promise.all(n)).filter(s=>s!==null);return console.log("[WaterfallPage] Successfully loaded",o.length,"images"),o}function p(a){return new Promise((n,l)=>{const o=new Image,s=setTimeout(()=>{o.src="",l(new Error(`Timeout loading image: ${a}`))},1e4);o.onload=()=>{clearTimeout(s),console.log("[WaterfallPage] Image loaded successfully:",a),n(o)},o.onerror=i=>{clearTimeout(s),console.error("[WaterfallPage] Image load error:",a,i),l(new Error(`Failed to load image: ${a}`))},o.src=a})}async function f(a){try{const n=document.createElement("canvas"),l=n.getContext("2d",{willReadFrequently:!0}),o=100;n.width=o,n.height=o;const s=a.naturalWidth/2,i=a.naturalHeight/2,u=Math.max(0,s-o/2),v=Math.max(0,i-o/2),g=Math.min(o,a.naturalWidth),E=Math.min(o,a.naturalHeight);l.drawImage(a,u,v,g,E,0,0,o,o);const y=l.getImageData(0,0,o,o).data;let k=0,Q=0,J=0,B=0;for(let I=0;I<y.length;I+=4){const te=y[I],ne=y[I+1],le=y[I+2];y[I+3]>128&&(k+=te,Q+=ne,J+=le,B++)}const oe=Math.round(k/B),Z=Math.round(Q/B),ee=Math.round(J/B),U=W(oe,Z,ee);return`hsl(${U.h}, ${U.s}%, ${U.l}%)`}catch(n){return console.error("[WaterfallPage] Failed to extract dominant color:",n),"hsl(250, 60%, 65%)"}}function W(a,n,l){a/=255,n/=255,l/=255;const o=Math.max(a,n,l),s=Math.min(a,n,l),i=o-s;let u=0,v=0,g=(o+s)/2;if(i!==0)switch(v=g>.5?i/(2-o-s):i/(o+s),o){case a:u=((n-l)/i+(n<l?6:0))/6;break;case n:u=((l-a)/i+2)/6;break;case l:u=((a-n)/i+4)/6;break}return u=Math.round(u*360),v=Math.round(v*100),g=Math.round(g*100),{h:u,s:v,l:g}}function D(a){let n=0;for(let l=0;l<a.length;l++){const o=a.charCodeAt(l);n=(n<<5)-n+o,n=n&n}return`img-${Math.abs(n)}`}function L(a){const n=[/(\d{4})-(\d{2})-(\d{2})/,/(\d{4})(\d{2})(\d{2})/,/(\d{4})_(\d{2})_(\d{2})/];for(const l of n){const o=a.match(l);if(o){const[,s,i,u]=o;try{const v=`${s}-${i}-${u}`,g=new Date(v);if(!isNaN(g.getTime()))return g.toISOString()}catch{console.warn("[WaterfallPage] Invalid date extracted from filename:",a)}}}return null}async function M(a){const n=a.map(async l=>{try{const o=await fetch(l.mdPath,{method:"HEAD"});l.hasDescription=o.ok}catch{l.hasDescription=!1}return l});return await Promise.all(n)}function q(a){return a.sort((n,l)=>{const o=new Date(n.date);return new Date(l.date)-o})}async function K(){try{const a=await V(),n=Y(a),l=await C(n),o=await M(l),s=q(o);H.value=s,console.log(`[WaterfallPage] Loaded ${s.length} images`)}catch(a){console.error("[WaterfallPage] Failed to load gallery images:",a),H.value=[]}}async function _(a,n){if(console.log("[WaterfallPage] Image clicked:",a,n),N.value=n,$.value=a,z.value=!0,a.hasDescription&&a.mdPath)try{console.log("[WaterfallPage] Loading description from:",a.mdPath);const l=await fetch(a.mdPath);if(l.ok){const o=await l.text();let s=o;try{s=We(o).body}catch{console.log("[WaterfallPage] No front-matter found, using raw content")}const i=he.render(s);x.value=i,console.log("[WaterfallPage] Description loaded and rendered successfully")}else console.warn("[WaterfallPage] Failed to load description:",l.status),x.value=""}catch(l){console.error("[WaterfallPage] Error loading description:",l),x.value=""}else console.log("[WaterfallPage] No description file for this image"),x.value=""}function F(){console.log("[WaterfallPage] Closing modal"),$.value=null,z.value=!1,x.value="",N.value=null,R.value&&R.value.resetAllCardStates&&R.value.resetAllCardStates()}return fe(()=>{K()}),(a,n)=>(b(),P(Pe,null,[ce(ye,{"show-tip-list":!1,"show-info-list":!1},{main:ve(()=>[ce(we,{ref_key:"waterfallPanelRef",ref:R,images:H.value,onImageClick:_},null,8,["images"])]),_:1}),$.value?(b(),ge(ot,{key:0,image:$.value,description:x.value,"trigger-card-rect":N.value,onClose:F},null,8,["image","description","trigger-card-rect"])):A("",!0)],64))}},gt=pe(nt,[["__scopeId","data-v-5313561e"]]);export{gt as default};
