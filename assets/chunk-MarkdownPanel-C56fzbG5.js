const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-SteamGameBlock-BHCivTlN.js","assets/entry-index-D8c4lH7g.js","assets/chunk-mermaid-lib--N4Maba6.js","assets/asset-index-whA3utIM.css","assets/chunk-color-thief-DF3QbzqH.js","assets/chunk-_plugin-vue_export-helper-DlAUqK2U.js","assets/asset-SteamGameBlock-B-ltQF1U.css","assets/chunk-BangumiBlock-ClDs8JIp.js","assets/asset-BangumiBlock-CZgwujlY.css","assets/chunk-BilibiliVideoBlock-Ci2G_TiQ.js","assets/asset-BilibiliVideoBlock-DE3SKqHY.css","assets/chunk-GithubRepoBlock-D5JFKsd7.js","assets/asset-GithubRepoBlock-CkND9FTr.css","assets/chunk-XiaohongshuNoteBlock-QA0pO13u.js","assets/asset-XiaohongshuNoteBlock-C8nWHP7E.css","assets/chunk-CarouselBlock-CZyyHpua.js","assets/asset-CarouselBlock-B-7UFdv-.css"])))=>i.map(i=>d[i]);
import{an as D,_ as y}from"./chunk-mermaid-lib--N4Maba6.js";import{r as u,i as A,v as ce,f as de,j as ue,x as me,b as h,o as v,e as r,l as _,c as ve,a as k,m as z,t as w,w as R,G as K,F as he,k as ge,T as pe,g as _e,q as fe,n as $,d as C}from"./entry-index-D8c4lH7g.js";import{f as ye}from"./chunk-index-NHvVYUgd.js";import{m as ke}from"./chunk-MarkdownRenender-CYXJ7tNL.js";import{r as we}from"./chunk-DynamicComponentRenderer-Db7kQm2w.js";import Ce from"./chunk-IconCategory-DdHYjmAG.js";import Me from"./chunk-IconDate-C_bF4FIs.js";import be from"./chunk-ImageViewer-DJrmNvYb.js";import Te from"./chunk-UtterancesComments-AThzYdu-.js";import{_ as Se}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"image-container"},xe=["src"],Ee={class:"overlay"},Ae={class:"header-content"},$e={class:"post-title"},Ie={class:"meta-info"},Pe={key:0,class:"category-panel"},He={key:1,class:"meta-divider"},Ve={key:2,class:"date-panel"},Be={key:0,class:"article-stats"},De={class:"stat-item"},Re={class:"stat-content"},qe={class:"stat-value"},Ne={class:"stat-item"},Oe={class:"stat-content"},Ue={class:"stat-value"},Ge={key:0,class:"stat-divider"},Fe={key:1,class:"stat-item stat-tags"},je={class:"stat-content"},ze={class:"tags-container"},Ke=["innerHTML"],We={__name:"MarkdownPanel",props:{markdownUrl:{type:String,required:!0},decryptedContent:{type:String,default:null}},setup(W){const Y=C(()=>y(()=>import("./chunk-SteamGameBlock-BHCivTlN.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),X=C(()=>y(()=>import("./chunk-BangumiBlock-ClDs8JIp.js"),__vite__mapDeps([7,1,2,3,4,5,8]))),J=C(()=>y(()=>import("./chunk-BilibiliVideoBlock-Ci2G_TiQ.js"),__vite__mapDeps([9,1,2,3,5,10]))),Q=C(()=>y(()=>import("./chunk-GithubRepoBlock-D5JFKsd7.js"),__vite__mapDeps([11,1,2,3,5,12]))),Z=C(()=>y(()=>import("./chunk-XiaohongshuNoteBlock-QA0pO13u.js"),__vite__mapDeps([13,1,2,3,5,14]))),ee=C(()=>y(()=>import("./chunk-CarouselBlock-CZyyHpua.js"),__vite__mapDeps([15,5,1,2,3,16]))),b=W,s=u({}),I=u(""),T=u(null),f=u(null),q=u(null),N=u(null),P=u(0),O=u(!1),S=u(!1),U=u(""),H=u(""),V=u("img"),G=u(""),L=u({h:210,s:70,l:55}),M=u({h:220,s:65,l:50}),x=u({wordCount:0,readingTime:0}),te=A(()=>{const{h:o,s:e,l:a}=L.value,{h:l,s:n,l:i}=M.value;return{"--primary-hue":o,"--primary-sat":e+"%","--primary-light":a+"%","--accent-hue":l,"--accent-sat":n+"%","--accent-light":i+"%","--primary-color":`hsl(${o}, ${e}%, ${a}%)`,"--primary-light-color":`hsl(${o}, ${e}%, ${Math.min(a+15,85)}%)`,"--primary-dark-color":`hsl(${o}, ${e}%, ${Math.max(a-15,20)})`,"--accent-color":`hsl(${l}, ${n}%, ${i}%)`,"--gradient":`linear-gradient(135deg, hsl(${o}, ${e}%, ${a}%) 0%, hsl(${l}, ${n}%, ${i}%) 100%)`}}),ae=o=>{const a=o.replace(/<[^>]*>/g,"").replace(/\s+/g,"").length,l=Math.ceil(a/300);x.value={wordCount:a,readingTime:l}},oe=()=>{var l;const o=(l=q.value)==null?void 0:l.querySelector(".header-image"),e=N.value;if(!o||!e)return;const a=e.getContext("2d");e.width=o.width,e.height=o.height;try{a.drawImage(o,0,0,e.width,e.height);const n=a.getImageData(0,0,e.width,e.height).data,i=new Map;for(let t=0;t<n.length;t+=40){const m=n[t],d=n[t+1],c=n[t+2];if(n[t+3]<128||m>240&&d>240&&c>240||m<15&&d<15&&c<15)continue;const g=se(m,d,c);if(g.s>20){const E=`${Math.round(g.h/10)*10}-${Math.round(g.s/10)*10}`;i.set(E,(i.get(E)||0)+1)}}if(i.size>0){const t=Array.from(i.entries()).sort((p,g)=>g[1]-p[1]),[m]=t[0],[d,c]=m.split("-").map(Number);if(L.value={h:d,s:Math.min(c+10,80),l:55},t.length>1){const[p]=t[1],[g,E]=p.split("-").map(Number);M.value={h:g,s:Math.min(E+5,75),l:50}}else M.value={h:(d+30)%360,s:Math.min(c+5,75),l:50}}}catch(n){console.warn("无法提取图片颜色，使用默认配色:",n),L.value={h:210,s:70,l:55},M.value={h:220,s:65,l:50}}},se=(o,e,a)=>{o/=255,e/=255,a/=255;const l=Math.max(o,e,a),n=Math.min(o,e,a);let i,t,m=(l+n)/2;if(l===n)i=t=0;else{const d=l-n;switch(t=m>.5?d/(2-l-n):d/(l+n),l){case o:i=((e-a)/d+(e<a?6:0))/6;break;case e:i=((a-o)/d+2)/6;break;case a:i=((o-e)/d+4)/6;break}}return{h:Math.round(i*360),s:Math.round(t*100),l:Math.round(m*100)}},F=()=>{if(!f.value||!T.value)return;const o=T.value.offsetTop,e=T.value.scrollHeight,a=window.innerHeight,l=window.scrollY,n=l-o,i=e-a,t=Math.min(Math.max(n/i*100,0),100);P.value=t,O.value=l>500},le=()=>{window.scrollTo({top:0,behavior:"smooth"})},j=async(o,e=null)=>{try{let a;e?(a=e,console.log("使用解密后的内容")):a=(await _e.get(o)).data;const{body:l}=ye(a),{meta:n}=await fe(a);s.value=n,s.value.img&&(s.value.img=`/Posts/Images/${s.value.img}`);const i=new Date(s.value.date),t=i.getHours();s.value.date=i.toLocaleDateString().replace(/\//g,"月").replace("月","年")+"日",t<6?s.value.date+=" 凌晨":t<12?s.value.date+=" 上午":t<18?s.value.date+=" 下午":s.value.date+=" 晚上",I.value=ke.render(l),ae(I.value),await $();const m=f.value;if(m&&we(m,{steamgameblock:Y,bangumiblock:X,bilibilivideoblock:J,githubrepoblock:Q,xiaohongshunoteblock:Z,carouselblock:ee}),await $(),typeof D<"u")try{D.mermaidAPI.reset(),await D.run({nodes:document.querySelectorAll(".mermaid")}),await $(),document.querySelectorAll(".mermaid svg").forEach(c=>{if(c.removeAttribute("width"),c.removeAttribute("height"),c.style.width="100%",c.style.height="400px",c.style.maxWidth="100%",c.style.maxHeight="400px",c.style.display="block",c.style.margin="0 auto",c.getAttribute("style")){const p=c.getAttribute("style");c.setAttribute("style",p.replace(/max-width:\s*\d+px;?/gi,""))}})}catch(d){console.warn("Mermaid rendering failed:",d)}await $(),ne()}catch(a){console.error("Error fetching or parsing markdown file:",a)}},ne=()=>{var l,n,i;const o=(l=f.value)==null?void 0:l.querySelectorAll(".markdown img");o==null||o.forEach(t=>{t.classList.add("clickable-image"),t.replaceWith(t.cloneNode(!0))});const e=(n=f.value)==null?void 0:n.querySelectorAll(".markdown img");e==null||e.forEach(t=>{t.classList.add("clickable-image"),t.addEventListener("click",()=>{V.value="img",U.value=t.src,H.value=t.alt||"",S.value=!0})});const a=(i=f.value)==null?void 0:i.querySelectorAll(".mermaid-wrapper");a==null||a.forEach(t=>{t.classList.add("clickable-mermaid");const m=t._clickHandler;m&&t.removeEventListener("click",m);const d=()=>{const c=t.querySelector(".mermaid");if(c){const p=c.querySelector("svg");if(p){const g=p.cloneNode(!0);console.log("[Mermaid Click] SVG found, outer HTML length:",g.outerHTML.length),V.value="svg",G.value=g.outerHTML,H.value="Mermaid 图表",S.value=!0}else console.warn("[Mermaid Click] SVG element not found in mermaid div")}else console.warn("[Mermaid Click] Mermaid div not found")};t._clickHandler=d,t.addEventListener("click",d)})};ce(()=>[b.markdownUrl,b.decryptedContent],([o,e])=>{j(o,e),P.value=0,L.value={h:210,s:70,l:55},M.value={h:220,s:65,l:50}},{immediate:!0}),de(()=>{j(b.markdownUrl,b.decryptedContent),window.addEventListener("scroll",F)}),ue(()=>{window.removeEventListener("scroll",F)});const B=A(()=>s.value.categories&&s.value.categories.length>0?s.value.categories[s.value.categories.length-1]:""),re=A(()=>s.value.categories&&s.value.categories.length>0?{name:"CategoryPage",params:{fullPath:s.value.categories.join("/")}}:"#"),ie=A(()=>({name:"ArchivePage"}));return(o,e)=>{const a=me("router-link");return v(),h("div",{class:"MarkdownPanel",ref_key:"panelRef",ref:T,style:z(te.value)},[r("div",{class:"reading-progress",style:z({width:P.value+"%"})},null,4),r("div",{class:"post-header",ref_key:"headerRef",ref:q},[r("div",Le,[s.value.img?(v(),h("img",{key:0,src:s.value.img,alt:"Post Image",class:"header-image",crossorigin:"anonymous",onLoad:oe},null,40,xe)):_("",!0),r("canvas",{ref_key:"colorCanvas",ref:N,style:{display:"none"}},null,512),r("div",Ee,[r("div",Ae,[r("h1",$e,w(s.value.title),1),r("div",Ie,[B.value?(v(),h("div",Pe,[k(Ce,{style:{width:"1rem",height:"1rem"}}),k(a,{to:re.value},{default:R(()=>[K(w(B.value),1)]),_:1},8,["to"])])):_("",!0),B.value&&s.value.date?(v(),h("span",He,"•")):_("",!0),s.value.date?(v(),h("div",Ve,[k(Me,{style:{width:"1rem",height:"1rem"}}),k(a,{to:ie.value},{default:R(()=>[K(w(s.value.date),1)]),_:1},8,["to"])])):_("",!0)])])])])],512),x.value.wordCount>0?(v(),h("div",Be,[r("div",De,[r("div",Re,[e[1]||(e[1]=r("span",{class:"stat-label"},"字数",-1)),r("span",qe,w(x.value.wordCount.toLocaleString()),1)])]),e[4]||(e[4]=r("div",{class:"stat-divider"},null,-1)),r("div",Ne,[r("div",Oe,[e[2]||(e[2]=r("span",{class:"stat-label"},"阅读时间",-1)),r("span",Ue,w(x.value.readingTime)+" 分钟",1)])]),s.value.tags&&s.value.tags.length>0?(v(),h("div",Ge)):_("",!0),s.value.tags&&s.value.tags.length>0?(v(),h("div",Fe,[r("div",je,[e[3]||(e[3]=r("span",{class:"stat-label"},"标签",-1)),r("div",ze,[(v(!0),h(he,null,ge(s.value.tags,l=>(v(),h("span",{key:l,class:"tag"},w(l),1))),128))])])])):_("",!0)])):_("",!0),r("article",{class:"post-content markdown",ref_key:"contentRef",ref:f},[r("div",{innerHTML:I.value},null,8,Ke)],512),s.value.title?(v(),ve(Te,{key:1,issueTitle:s.value.title},null,8,["issueTitle"])):_("",!0),k(pe,{name:"fade"},{default:R(()=>[O.value?(v(),h("button",{key:0,class:"back-to-top",onClick:le},e[5]||(e[5]=[r("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[r("path",{d:"M12 19V5M5 12l7-7 7 7"})],-1)]))):_("",!0)]),_:1}),k(be,{visible:S.value,"onUpdate:visible":e[0]||(e[0]=l=>S.value=l),imageSrc:U.value,imageAlt:H.value,imageType:V.value,svgContent:G.value},null,8,["visible","imageSrc","imageAlt","imageType","svgContent"])],4)}}},lt=Se(We,[["__scopeId","data-v-91343d3a"]]);export{lt as default};
