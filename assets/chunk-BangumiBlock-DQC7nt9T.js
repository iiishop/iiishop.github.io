import{r as i,i as E,f as M,b as c,o as r,e,l as m,q as h,t as u,F as x,m as C,x as L,g as P}from"./entry-index-CVwcNbOi.js";import{u as R}from"./chunk-color-thief-DF3QbzqH.js";import{_ as H}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib-CtMrMl2-.js";const N={class:"card-content"},O={class:"cover-column"},q={class:"cover-wrapper"},W=["src"],X=["href"],G={class:"info-column"},J={class:"header-section"},K={class:"title"},Q={key:0,class:"rating-badge"},Y={class:"score-box"},Z={class:"score-val"},ee={class:"score-count"},se={key:0,class:"distribution-bar"},te=["title"],oe={key:1,class:"tags-container"},ae={key:2,class:"summary-section"},ne={class:"infobox-grid"},ce={class:"info-key"},re={class:"info-val"},le={__name:"BangumiBlock",props:{bangumiurl:String},setup(V){const B=V,d=i(""),f=i(""),p=i([]),v=i({score:0,total:0}),_=i([]),j=i([]),b=i(""),y=i(""),I=i(""),k=i(!0),A=()=>{k.value=!k.value},F=E(()=>({"--theme-color":y.value||"#3b82f6","--theme-secondary":I.value||"#06b6d4","--theme-bg-opacity":y.value?"0.1":"0.05"})),T=o=>{const a=o.target;if(!a.src.includes("loading.gif"))try{const l=new R().getPalette(a,3);l&&l.length>=2&&(y.value=`rgb(${l[0].join(",")})`,I.value=`rgb(${l[1].join(",")})`)}catch(t){console.warn("Color thief error",t)}},U=o=>["#22c55e","#84cc16","#a3e635","#facc15","#fcd34d","#fbbf24","#fb923c","#f87171","#ef4444","#dc2626"][o]||"#ccc",z=o=>{if(!o)return"";const a=o.replace(/^https?:\/\//,"");return`https://images.weserv.nl/?url=${encodeURIComponent(a)}&w=800&output=webp`},D=async()=>{try{const o=B.bangumiurl.match(/\/subject\/(\d+)/);if(!o)throw new Error("Invalid Bangumi URL");const t=`https://api.bgm.tv/v0/subjects/${o[1]}`,s=(await P.get(t,{headers:{"X-Auth-Token":void 0}})).data;if(s.images&&s.images.large&&(d.value=z(s.images.large)),f.value=s.name_cn||s.name,b.value=s.summary||"",s.tags&&(p.value=s.tags.slice(0,6).map(n=>n.name)),s.rating){v.value={score:s.rating.score,total:s.rating.total,count:s.rating.count};const n=s.rating.total||1;_.value=Array.from({length:10},(g,w)=>{const $=10-w,S=s.rating.count&&s.rating.count[$]||0;return{score:$,numberOfPersons:S,percent:S/n*100}})}s.infobox&&(j.value=s.infobox.filter(n=>["放送开始","又名","导演","制作","开发"].includes(n.key)||n.key.length<5).slice(0,8).map(n=>{let g="";return Array.isArray(n.value)?g=n.value.map(w=>w.v).join("、"):g=n.value,{key:n.key,value:g}}))}catch(o){console.error("Error fetching bgm details:",o),f.value="Failed to load info"}};return M(()=>{D()}),(o,a)=>(r(),c("div",{class:L(["bangumi-card",{loaded:d.value}]),style:m(F.value)},[e("div",{class:"bg-blur",style:m({backgroundImage:`url(${d.value})`})},null,4),e("div",N,[e("div",O,[e("div",q,[e("img",{src:d.value||"/assets/loading.gif",alt:"Cover",class:"cover-img",crossorigin:"anonymous",onLoad:T},null,40,W),e("div",{class:"cover-shadow",style:m({backgroundImage:`url(${d.value})`})},null,4)]),e("a",{href:B.bangumiurl,target:"_blank",class:"action-btn"},a[0]||(a[0]=[e("span",{class:"btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16"},[e("path",{d:"M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7z"})])],-1),e("span",null,"前往 Bangumi",-1)]),8,X)]),e("div",G,[e("div",J,[e("h2",K,u(f.value||"Loading..."),1),v.value.total>0?(r(),c("div",Q,[e("div",Y,[e("span",Z,u(v.value.score),1),a[1]||(a[1]=e("span",{class:"score-suffix"},"/ 10",-1))]),e("span",ee,u(v.value.total)+" 人评分",1)])):h("",!0)]),_.value.length>0?(r(),c("div",se,[(r(!0),c(x,null,C(_.value,(t,l)=>(r(),c("div",{key:l,class:"dist-segment",style:m({width:t.percent+"%",backgroundColor:U(l)}),title:`${t.score}分: ${t.numberOfPersons}人 (${t.percent.toFixed(1)}%)`},null,12,te))),128))])):h("",!0),p.value.length?(r(),c("div",oe,[(r(!0),c(x,null,C(p.value,t=>(r(),c("span",{key:t,class:"tag-pill"},u(t),1))),128))])):h("",!0),b.value?(r(),c("div",ae,[e("div",{class:L(["summary-text",{collapsed:k.value}]),onClick:A},u(b.value),3)])):h("",!0),e("div",ne,[(r(!0),c(x,null,C(j.value,(t,l)=>(r(),c("div",{key:l,class:"info-item"},[e("span",ce,u(t.key),1),e("span",re,u(t.value),1)]))),128))])])])],6))}},ge=H(le,[["__scopeId","data-v-31b31a48"]]);export{ge as default};
