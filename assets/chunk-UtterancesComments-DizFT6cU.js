import{r as i,f as _,j as k,v as T,b as f,o as p,e as g,h as a,n as A}from"./entry-index-DYwYFgky.js";import{_ as M}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib--N4Maba6.js";const E={key:0,class:"comments-disabled"},w={key:1,class:"comments-not-configured"},x={__name:"UtterancesComments",props:{issueTitle:{type:String,default:""},repo:{type:String,default:""},theme:{type:String,default:""}},setup(b){const s=b,C=i(null),r=i(null),o=i(null),u=i(!1),l=i(!1),v=()=>{var e;const n=document.documentElement.getAttribute("data-theme")||"day",t=n==="dark"||n==="night";return(e=a.UtterancesConfig)!=null&&e.themeMapping&&a.UtterancesConfig.themeMapping[n]||(t?"github-dark":"github-light")},h=()=>{var t;if(!((t=a.UtterancesConfig)!=null&&t.enabled)){u.value=!1;return}u.value=!0;const n=s.repo||a.UtterancesConfig.repo;if(!n){l.value=!1,console.warn("[Utterances] Repository not configured");return}l.value=!0,r.value&&(r.value.innerHTML=""),o.value&&(o.value.remove(),o.value=null),A(()=>{if(!r.value)return;const e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo",n);const c=a.UtterancesConfig.issueMapping||"pathname";c==="title"&&s.issueTitle?(e.setAttribute("issue-term","title"),e.setAttribute("label",s.issueTitle)):e.setAttribute("issue-term",c);const d=a.UtterancesConfig.label||"comment";e.setAttribute("label",d);const U=s.theme||a.UtterancesConfig.theme||v();e.setAttribute("theme",U),e.setAttribute("crossorigin","anonymous"),e.async=!0,o.value=e,r.value.appendChild(e)})},y=()=>{var e,c;if(!u.value||!l.value)return;const n=s.theme||a.UtterancesConfig.theme||v(),t=(e=r.value)==null?void 0:e.querySelector("iframe.utterances-frame");if(t){const d={type:"set-theme",theme:n};(c=t.contentWindow)==null||c.postMessage(d,"https://utteranc.es")}},m=i(null);return _(()=>{h(),m.value=new MutationObserver(n=>{n.forEach(t=>{t.type==="attributes"&&t.attributeName==="data-theme"&&(console.log("[Utterances] Theme changed, updating..."),y())})}),m.value.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]})}),k(()=>{m.value&&m.value.disconnect(),o.value&&o.value.remove()}),T(()=>[s.repo,s.theme,s.issueTitle],()=>{u.value&&l.value&&h()},{deep:!0}),(n,t)=>(p(),f("div",{class:"utterances-comments",ref_key:"commentsContainer",ref:C},[u.value?l.value?(p(),f("div",{key:2,ref_key:"utterancesContainer",ref:r,class:"utterances-container"},null,512)):(p(),f("div",w,t[1]||(t[1]=[g("p",null,"评论系统未配置，请在设置中配置 Utterances",-1)]))):(p(),f("div",E,t[0]||(t[0]=[g("p",null,"评论功能未启用",-1)])))],512))}},N=M(x,[["__scopeId","data-v-659e462e"]]);export{N as default};
