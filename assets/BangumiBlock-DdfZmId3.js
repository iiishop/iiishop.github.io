import{r,c as M,o as P,b as n,d as l,f as e,z as m,v as h,t as u,F as C,h as w,n as L,k as U}from"./index-CWFDtyq5.js";import{u as H}from"./color-thief-DF3QbzqH.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"card-content"},R={class:"cover-column"},T={class:"cover-wrapper"},q=["src"],G=["href"],J={class:"info-column"},K={class:"header-section"},Q={class:"title"},W={key:0,class:"rating-badge"},X={class:"score-box"},Y={class:"score-val"},Z={class:"score-count"},ee={key:0,class:"distribution-bar"},se=["title"],te={key:1,class:"tags-container"},oe={key:2,class:"summary-section"},ae={class:"infobox-grid"},ne={class:"info-key"},le={class:"info-val"},ce={__name:"BangumiBlock",props:{bangumiurl:String},setup(V){const B=V,d=r(""),f=r(""),_=r([]),v=r({score:0,total:0}),p=r([]),j=r([]),b=r(""),y=r(""),I=r(""),k=r(!0),z=()=>{k.value=!k.value},F=M(()=>({"--theme-color":y.value||"#3b82f6","--theme-secondary":I.value||"#06b6d4","--theme-bg-opacity":y.value?"0.1":"0.05"})),A=i=>{const o=i.target;if(!o.src.includes("loading.gif"))try{const c=new H().getPalette(o,3);c&&c.length>=2&&(y.value=`rgb(${c[0].join(",")})`,I.value=`rgb(${c[1].join(",")})`)}catch(t){console.warn("Color thief error",t)}},D=i=>["#22c55e","#84cc16","#a3e635","#facc15","#fcd34d","#fbbf24","#fb923c","#f87171","#ef4444","#dc2626"][i]||"#ccc",E=async()=>{try{const i=B.bangumiurl.match(/\/subject\/(\d+)/);if(!i)throw new Error("Invalid Bangumi URL");const t=`https://api.bgm.tv/v0/subjects/${i[1]}`,s=(await U.get(t)).data;if(s.images&&s.images.large&&(d.value=s.images.large.replace("http:","https:")),f.value=s.name_cn||s.name,b.value=s.summary||"",s.tags&&(_.value=s.tags.slice(0,6).map(a=>a.name)),s.rating){v.value={score:s.rating.score,total:s.rating.total,count:s.rating.count};const a=s.rating.total||1;p.value=Array.from({length:10},(g,x)=>{const S=10-x,$=s.rating.count&&s.rating.count[S]||0;return{score:S,numberOfPersons:$,percent:$/a*100}})}s.infobox&&(j.value=s.infobox.filter(a=>["放送开始","又名","导演","制作","开发"].includes(a.key)||a.key.length<5).slice(0,8).map(a=>{let g="";return Array.isArray(a.value)?g=a.value.map(x=>x.v).join("、"):g=a.value,{key:a.key,value:g}}))}catch(i){console.error("Error fetching bgm details:",i),f.value="Failed to load info"}};return P(()=>{E()}),(i,o)=>(l(),n("div",{class:L(["bangumi-card",{loaded:d.value}]),style:m(F.value)},[e("div",{class:"bg-blur",style:m({backgroundImage:`url(${d.value})`})},null,4),o[2]||(o[2]=e("div",{class:"bg-overlay"},null,-1)),e("div",O,[e("div",R,[e("div",T,[e("img",{src:d.value||"/assets/loading.gif",alt:"Cover",class:"cover-img",onLoad:A},null,40,q),e("div",{class:"cover-shadow",style:m({backgroundImage:`url(${d.value})`})},null,4)]),e("a",{href:B.bangumiurl,target:"_blank",class:"action-btn"},o[0]||(o[0]=[e("span",{class:"btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16"},[e("path",{d:"M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5c-1.11 0-2 .89-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7z"})])],-1),e("span",null,"前往 Bangumi",-1)]),8,G)]),e("div",J,[e("div",K,[e("h2",Q,u(f.value||"Loading..."),1),v.value.total>0?(l(),n("div",W,[e("div",X,[e("span",Y,u(v.value.score),1),o[1]||(o[1]=e("span",{class:"score-suffix"},"/ 10",-1))]),e("span",Z,u(v.value.total)+" 人评分",1)])):h("",!0)]),p.value.length>0?(l(),n("div",ee,[(l(!0),n(C,null,w(p.value,(t,c)=>(l(),n("div",{key:c,class:"dist-segment",style:m({width:t.percent+"%",backgroundColor:D(c)}),title:`${t.score}分: ${t.numberOfPersons}人 (${t.percent.toFixed(1)}%)`},null,12,se))),128))])):h("",!0),_.value.length?(l(),n("div",te,[(l(!0),n(C,null,w(_.value,t=>(l(),n("span",{key:t,class:"tag-pill"},u(t),1))),128))])):h("",!0),b.value?(l(),n("div",oe,[e("p",{class:L(["summary-text",{collapsed:k.value}]),onClick:z},u(b.value),3)])):h("",!0),e("div",ae,[(l(!0),n(C,null,w(j.value,(t,c)=>(l(),n("div",{key:c,class:"info-item"},[e("span",ne,u(t.key),1),e("span",le,u(t.value),1)]))),128))])])])],6))}},de=N(ce,[["__scopeId","data-v-51ec504e"]]);export{de as default};
