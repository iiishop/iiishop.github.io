import{r,i as K,f as Ce,W as He,b as S,o as $,e as s,a as Ae,l as q,D as pe,y as ye,m as ue,w as Fe,t as Y,T as Ge,j as Oe,v as qe,F as Ye,k as Xe,c as De}from"./entry-index-DaJ121bm.js";import{g as we}from"./chunk-index-D-nlVayj.js";import{_ as be}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import{f as Ne}from"./chunk-index-BvY5Kkhr.js";import"./chunk-mermaid-lib-Cmv1Qdle.js";const Ve={class:"image-wrapper"},Ue={key:0,class:"image-placeholder"},je={key:1,class:"image-error"},Je=["src","alt"],Ke={key:0,class:"info-overlay"},Qe={class:"info-content"},Ze={class:"image-title"},et={class:"image-meta"},tt={__name:"Graph",props:{image:{type:Object,required:!0},index:{type:Number,required:!0},column:{type:Number,default:0},position:{type:Object,default:null}},emits:["click","mouseenter","mouseleave"],setup(E,{expose:Q,emit:Z}){const d=E,T=Z,o=r(null),R=r(null),p=r(!1),k=r(!1),_=r(!1),m=r(!1),W=r(!1),L=r(!1),ee=r(.5),z=r(.5),I=r("50%"),g=r("50%");let P=null;const X=K(()=>{const h={"--card-aspect-ratio":d.image.aspectRatio||1,"--glow-x":I.value,"--glow-y":g.value};return d.position&&(h.position="absolute",h.left=`${d.position.x}px`,h.top=`${d.position.y}px`,h.width=`${d.position.width}px`,h.height=`${d.position.height}px`),h}),B=K(()=>({"--card-glow":d.image.dominantColor||"hsl(250, 60%, 65%)"})),H=K(()=>L.value?d.image.src:"");function D(h){requestAnimationFrame(()=>{p.value=!0}),T("mouseenter",d.index)}function te(h){if(!o.value||!p.value)return;const v=o.value.getBoundingClientRect(),M=(h.clientX-v.left)/v.width,V=(h.clientY-v.top)/v.height;ee.value=M,z.value=V,I.value=`${M*100}%`,g.value=`${V*100}%`}function ne(h){p.value=!1,I.value="50%",g.value="50%",T("mouseleave",d.index)}function N(){var M;if(k.value)return;k.value=!0;const h=(M=o.value)==null?void 0:M.getBoundingClientRect();we.timeline({onComplete:()=>{T("click",d.image,h)}}).to(o.value,{scale:1.05,duration:.3,ease:"power2.out"})}function ae(){k.value=!1,o.value&&we.to(o.value,{scale:1,opacity:1,duration:.4,ease:"power2.out"})}Q({resetCardState:ae});function ie(){_.value=!0,m.value=!1}function se(){m.value=!0,_.value=!1,console.error(`Failed to load image: ${d.image.src}`)}function oe(){if(!o.value)return;const h={root:null,rootMargin:"200px",threshold:.01};P=new IntersectionObserver(v=>{v.forEach(M=>{M.isIntersecting&&(W.value=!0,L.value=!0,P&&o.value&&P.unobserve(o.value))})},h),P.observe(o.value)}function A(){P&&o.value&&(P.unobserve(o.value),P.disconnect(),P=null)}return Ce(()=>{oe()}),He(()=>{A()}),(h,v)=>($(),S("div",{class:ye(["graph-card",{"is-hovered":p.value,"is-expanding":k.value}]),style:ue(X.value),onMouseenter:D,onMousemove:te,onMouseleave:ne,onClick:N,ref_key:"cardRef",ref:o},[s("div",Ve,[!_.value&&!m.value?($(),S("div",Ue,v[0]||(v[0]=[pe('<div class="placeholder-shimmer" data-v-905488cb></div><div class="placeholder-icon" data-v-905488cb><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-905488cb><rect x="3" y="3" width="18" height="18" rx="2" data-v-905488cb></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-905488cb></circle><polyline points="21 15 16 10 5 21" data-v-905488cb></polyline></svg></div>',2)]))):q("",!0),m.value?($(),S("div",je,v[1]||(v[1]=[pe('<div class="error-icon" data-v-905488cb><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-905488cb><circle cx="12" cy="12" r="10" data-v-905488cb></circle><line x1="12" y1="8" x2="12" y2="12" data-v-905488cb></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-905488cb></line></svg></div><p class="error-text" data-v-905488cb>Failed to load</p>',2)]))):q("",!0),L.value?($(),S("img",{key:2,ref_key:"imageRef",ref:R,src:H.value,alt:E.image.alt,class:ye(["graph-image",{"is-loaded":_.value,"is-error":m.value}]),loading:"lazy",onLoad:ie,onError:se},null,42,Je)):q("",!0),s("div",{class:"image-glow",style:ue(B.value)},null,4),v[2]||(v[2]=s("div",{class:"scan-line"},null,-1))]),Ae(Ge,{name:"info-fade"},{default:Fe(()=>[p.value?($(),S("div",Ke,[s("div",Qe,[s("h3",Ze,Y(E.image.title),1),s("p",et,Y(E.image.date),1)])])):q("",!0)]),_:1}),v[3]||(v[3]=s("div",{class:"border-glow"},null,-1))],38))}},nt=be(tt,[["__scopeId","data-v-905488cb"]]),at={class:"gallery-header"},it={class:"header-content"},st={class:"header-stats"},ot={class:"stat-item"},lt={class:"stat-number"},rt={class:"stat-item"},ct={class:"stat-number"},ut={class:"stat-item"},dt={class:"stat-number"},ht={key:0,class:"gallery-footer"},vt={__name:"WaterfallPanel",props:{images:{type:Array,default:()=>[]}},emits:["image-click"],setup(E,{expose:Q,emit:Z}){const d=E,T=Z,o=r(null),R=r(null),p=r(null),k=r([]),_=r(null),m=r([]),W=r(4);r(300);const L=r(20),ee=r(8),z=r(new Map),I=r(new Map),g=r([]);async function P(e){if(!e.mdPath)return e;try{const t=await fetch(e.mdPath);if(!t.ok)return console.log(`[WaterfallPanel] .md file not found for ${e.id}`),e;if((t.headers.get("content-type")||"").includes("text/html"))return console.log(`[WaterfallPanel] .md file not found (got HTML) for ${e.id}`),e;const a=await t.text();if(!a||!a.trim())return e;const i=a.trim().toLowerCase();if(i.startsWith("<!doctype")||i.startsWith("<html"))return e;const c=Ne(a).attributes;return{...e,title:c.title||e.title,date:c.date||e.date,aspectRatio:c.aspectRatio||e.aspectRatio,dominantColor:c.dominantColor||e.dominantColor,_originalTitle:e.title,_originalDate:e.date,_hasMetadata:!0}}catch(t){return console.log(`[WaterfallPanel] Failed to load .md for ${e.id}:`,t),e}}async function X(e){console.log("[WaterfallPanel] Enriching images with metadata...");const t=e.map(a=>P(a)),n=await Promise.all(t);return console.log("[WaterfallPanel] Enrichment complete"),n}let B=!1,H=null;function D(e){if(!o.value)return;const t=o.value.getBoundingClientRect();le.value={x:e.clientX-t.left,y:e.clientY-t.top+window.scrollY}}const te=K(()=>({position:"relative",width:"100%",minHeight:`${se()}px`}));function ne(){if(!o.value)return 4;const n=o.value.offsetWidth-32*2;return n<600?1:n<900?2:n<1200?3:4}function N(e,t){const n=`${e}-${t}`;if(I.value.has(n))return I.value.get(n);const a=(Math.random()-.5)*2*ee.value;return I.value.set(n,a),a}function ae(e){let t=0,n=e[0];for(let a=1;a<e.length;a++)e[a]<n&&(n=e[a],t=a);return t}function ie(e,t,n,a){var C;const l=L.value*(W.value-1),b=((((C=o.value)==null?void 0:C.offsetWidth)||1200)-64-l)/W.value,y=b/(n||1),f=N(a,"x"),u=32+e*(b+L.value)+f,w=N(a,"y"),x=t+w;return{x:u,y:x,width:b,height:y,column:e}}function se(){if(m.value.length===0)return 0;const e=new Array(W.value).fill(0);return m.value.forEach(t=>{const n=t.y+t.height;n>e[t.column]&&(e[t.column]=n)}),Math.max(...e)+32}function oe(e,t){if(!e||e.length===0)return[];const n=g.value.length>0?g.value:e,a=new Array(t).fill(0),i=[];return n.forEach((l,c)=>{const b=l.aspectRatio||(l.width&&l.height?l.width/l.height:1),y=ae(a),f=ie(y,a[y],b,l.id);i.push({...f,id:l.id,index:c}),a[y]=f.y+f.height+L.value}),i}function A(){if(!o.value||m.value.length===0){k.value=g.value.length>0?g.value:d.images;return}const e=g.value.length>0?g.value:d.images,t=window.scrollY||document.documentElement.scrollTop,n=window.innerHeight,a=o.value.offsetTop,i=t-a,l=i+n,c=n,b=Math.max(0,i-c),y=l+c,f=[];m.value.forEach(u=>{const w=u.y;if(u.y+u.height>=b&&w<=y){const C=e[u.index];C&&f.push(C)}}),k.value=f}function h(e){const t=m.value.find(n=>n.id===e);return t?t.column:0}function v(e){return m.value.find(t=>t.id===e)||null}async function M(){g.value.length===0&&d.images.length>0&&(g.value=await X(d.images)),W.value=ne();const e=g.value.length>0?g.value:d.images;m.value=oe(e,W.value),A()}function V(e,t){t?z.value.set(e,t):z.value.delete(e)}function xe(e){const t=m.value.find(n=>n.id===e);t&&(_.value=t.index)}function Me(e){_.value=null}function ke(e,t){T("image-click",e,t)}function Pe(){z.value.forEach(e=>{e&&e.resetCardState&&e.resetCardState()})}Q({resetAllCardStates:Pe});class Re{constructor(t){this.canvas=t,this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.vx=(Math.random()-.5)*.5,this.vy=(Math.random()-.5)*.5,this.size=Math.random()*2+1,this.opacity=Math.random()*.3+.1,this.hue=250+Math.random()*30}update(t,n){const a=t-this.x,i=n-this.y,l=Math.sqrt(a*a+i*i);if(l<200){const c=(200-l)/200;this.vx+=a/l*c*.1,this.vy+=i/l*c*.1}this.vx*=.95,this.vy*=.95,this.x+=this.vx,this.y+=this.vy,this.x<0&&(this.x=this.canvas.width),this.x>this.canvas.width&&(this.x=0),this.y<0&&(this.y=this.canvas.height),this.y>this.canvas.height&&(this.y=0)}draw(t){t.fillStyle=`hsla(${this.hue}, 70%, 65%, ${this.opacity})`,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}let U=[],j=null,F=null;const le=r({x:0,y:0});function _e(){if(!R.value)return null;const e=R.value,t=e.getContext("2d");if(!t)return null;const n=()=>{const a=e.getBoundingClientRect(),i=window.devicePixelRatio||1;e.width=a.width*i,e.height=a.height*i,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`,t.scale(i,i),$e(e)};return n(),F=n,window.addEventListener("resize",F),{canvas:e,ctx:t}}function $e(e){const t=e.offsetWidth||e.width,n=e.offsetHeight||e.height,a=Math.floor(t*n/15e3);U=[];for(let i=0;i<a;i++)U.push(new Re(e))}function de(e,t){if(!e||!t)return;const n=t.offsetWidth||t.width,a=t.offsetHeight||t.height;e.clearRect(0,0,n,a),U.forEach(i=>{i.update(le.value.x,le.value.y),i.draw(e)}),j=requestAnimationFrame(()=>de(e,t))}function We(){const e=_e();if(!e)return;const{canvas:t,ctx:n}=e;de(n,t)}function Se(){if(j&&(cancelAnimationFrame(j),j=null),F&&(window.removeEventListener("resize",F),F=null),U=[],R.value){const e=R.value.getContext("2d");e&&e.clearRect(0,0,R.value.width,R.value.height)}}let J=null,G=null;const re=r(0);function Ee(){if(!p.value)return null;const e=p.value,t=e.getContext("2d");if(!t)return null;const n=()=>{const a=e.getBoundingClientRect(),i=window.devicePixelRatio||1;e.width=a.width*i,e.height=a.height*i,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`,t.scale(i,i)};return n(),G=n,window.addEventListener("resize",G),{canvas:e,ctx:t}}function he(e,t){if(!e||!t)return;const n=t.offsetWidth||t.width,a=t.offsetHeight||t.height;e.clearRect(0,0,n,a),_.value!==null&&Te(e,m.value,_.value,re.value),re.value+=16,J=requestAnimationFrame(()=>he(e,t))}function Le(){const e=Ee();if(!e)return;const{canvas:t,ctx:n}=e;he(n,t)}function Ie(){if(J&&(cancelAnimationFrame(J),J=null),G&&(window.removeEventListener("resize",G),G=null),re.value=0,p.value){const e=p.value.getContext("2d");e&&e.clearRect(0,0,p.value.width,p.value.height)}}function Te(e,t,n,a){if(n===null||!t||t.length===0)return;const i=t[n];if(!i)return;const l=i.x+i.width/2,c=i.y+i.height/2;t.forEach((f,u)=>{if(u===n)return;const w=f.x+f.width/2,x=f.y+f.height/2,C=w-l,fe=x-c,ce=Math.sqrt(C*C+fe*fe);if(ce<300){const Be=(1-ce/300)*.3,me=(w+l)/2+(Math.random()-.5)*50,ge=(x+c)/2+(Math.random()-.5)*50;e.strokeStyle=`hsla(250, 70%, 65%, ${Be})`,e.lineWidth=2,e.beginPath(),e.moveTo(l,c),e.quadraticCurveTo(me,ge,w,x),e.stroke(),ze(e,l,c,w,x,me,ge,a,ce)}});const b=30,y=e.createRadialGradient(l,c,0,l,c,b);y.addColorStop(0,"hsla(340, 85%, 65%, 0.4)"),y.addColorStop(1,"hsla(340, 85%, 65%, 0)"),e.fillStyle=y,e.beginPath(),e.arc(l,c,b,0,Math.PI*2),e.fill()}function ze(e,t,n,a,i,l,c,b,y){const f=2e3+y*2,u=b%f/f,w=(1-u)*(1-u)*t+2*(1-u)*u*l+u*u*a,x=(1-u)*(1-u)*n+2*(1-u)*u*c+u*u*i,C=e.createRadialGradient(w,x,0,w,x,6);C.addColorStop(0,"hsla(340, 85%, 65%, 0.9)"),C.addColorStop(.5,"hsla(340, 85%, 65%, 0.5)"),C.addColorStop(1,"hsla(340, 85%, 65%, 0)"),e.fillStyle=C,e.beginPath(),e.arc(w,x,6,0,Math.PI*2),e.fill(),e.fillStyle="hsla(340, 100%, 75%, 1)",e.beginPath(),e.arc(w,x,3,0,Math.PI*2),e.fill()}function ve(){B||(H=requestAnimationFrame(()=>{A(),B=!1}),B=!0)}let O=null;return Ce(()=>{We(),Le(),M(),o.value&&typeof ResizeObserver<"u"&&(O=new ResizeObserver(()=>{M()}),O.observe(o.value)),window.addEventListener("scroll",ve,{passive:!0}),o.value&&o.value.addEventListener("mousemove",D,{passive:!0}),A()}),Oe(()=>{O&&o.value&&(O.unobserve(o.value),O.disconnect()),window.removeEventListener("scroll",ve),H&&cancelAnimationFrame(H),Se(),Ie(),o.value&&o.value.removeEventListener("mousemove",D)}),qe(()=>d.images,async()=>{g.value=await X(d.images),M()},{deep:!0}),(e,t)=>($(),S("div",{class:"waterfall-container",ref_key:"containerRef",ref:o},[s("canvas",{ref_key:"particleCanvas",ref:R,class:"particle-layer"},null,512),s("canvas",{ref_key:"magneticCanvas",ref:p,class:"magnetic-layer"},null,512),s("div",at,[s("div",it,[t[5]||(t[5]=s("h1",{class:"gallery-title"},[s("span",{class:"title-main"},"流光画廊"),s("span",{class:"title-sub"},"Flowing Light Gallery")],-1)),t[6]||(t[6]=s("p",{class:"gallery-description"}," 探索光影交织的视觉世界，每一帧都是独特的记忆 ",-1)),s("div",st,[s("div",ot,[s("span",lt,Y(E.images.length),1),t[0]||(t[0]=s("span",{class:"stat-label"},"作品",-1))]),t[3]||(t[3]=s("div",{class:"stat-divider"},null,-1)),s("div",rt,[s("span",ct,Y(W.value),1),t[1]||(t[1]=s("span",{class:"stat-label"},"列",-1))]),t[4]||(t[4]=s("div",{class:"stat-divider"},null,-1)),s("div",ut,[s("span",dt,Y(k.value.length),1),t[2]||(t[2]=s("span",{class:"stat-label"},"可见",-1))])])]),t[7]||(t[7]=s("div",{class:"header-decoration"},[s("div",{class:"deco-circle deco-1"}),s("div",{class:"deco-circle deco-2"}),s("div",{class:"deco-circle deco-3"})],-1))]),s("div",{class:"waterfall-grid",style:ue(te.value)},[($(!0),S(Ye,null,Xe(k.value,(n,a)=>($(),De(nt,{key:n.id,ref_for:!0,ref:i=>V(n.id,i),image:n,index:a,column:h(n.id),position:v(n.id),onClick:ke,onMouseenter:i=>xe(n.id),onMouseleave:i=>Me(n.id)},null,8,["image","index","column","position","onMouseenter","onMouseleave"]))),128))],4),k.value.length>0?($(),S("div",ht,t[8]||(t[8]=[s("div",{class:"footer-line"},null,-1),s("p",{class:"footer-text"},"已加载全部作品",-1),s("div",{class:"footer-line"},null,-1)]))):q("",!0)],512))}},wt=be(vt,[["__scopeId","data-v-aaaab798"]]);export{wt as default};
