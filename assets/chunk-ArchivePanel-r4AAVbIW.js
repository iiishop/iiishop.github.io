import{r as l,v as L,f as N,k as y,n as S,i as P,b as i,o as c,e as t,t as u,F as H,m as I,q as f,y as O,g as U,p as E}from"./entry-index-CL9gm64C.js";import{g as R}from"./chunk-index-D-nlVayj.js";import{_ as Y}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"ArchivePanel"},z={class:"panel-header"},W={class:"header-text"},$={class:"subtitle"},q={class:"timeline-container"},G={key:0,class:"timeline-marker year-marker"},J={class:"year-text"},K={key:1,class:"timeline-marker month-marker"},Q={class:"month-text"},X=["onClick"],ee={class:"post-info"},te={class:"post-date"},se={key:0,class:"loading-indicator"},ae={key:1,class:"end-message"},A=20,oe={__name:"ArchivePanel",props:{markdownUrls:{type:Array,default:()=>[]}},setup(Z){const w=Z,b=l({}),m=l([]),v=l([]),x=L(),k=l(1),p=l(!1),h=l(!0),g=l(null);async function C(){const o=y.markdowns,e=[];for(const[s,a]of Object.entries(o))if(!(w.markdownUrls.length>0&&!w.markdownUrls.includes(s)))try{const r=(await U.get(s.startsWith("http")?s:new URL(s,import.meta.url).href)).data,{meta:d}=await E(r),T=d.tags&&(Array.isArray(d.tags)?d.tags.includes("公告"):d.tags==="公告"),F=d.title&&d.title.toLowerCase()==="about";!T&&!F&&e.push({url:s,...a})}catch(n){console.error(`Failed to check tags for ${s}:`,n),e.push({url:s,...a})}return e.sort((s,a)=>{const n=new Date(s.date);return new Date(a.date)-n}),e}function _(){p.value||!h.value||(p.value=!0,setTimeout(()=>{const o=(k.value-1)*A,e=o+A,s=m.value.slice(o,e);s.length>0?(v.value.push(...s),k.value++,e>=m.value.length&&(h.value=!1)):h.value=!1,p.value=!1},300))}function V(){if(!g.value)return;const o=new IntersectionObserver(e=>{e[0].isIntersecting&&h.value&&!p.value&&_()},{root:null,rootMargin:"100px",threshold:.1});return o.observe(g.value),()=>o.disconnect()}N(async()=>{b.value=y.markdowns,m.value=await C(),_(),R.from(".ArchivePanel",{opacity:0,y:40,duration:.8,ease:"power3.out"}),await S(),V()});function D(o){const e=o.split("/").filter(r=>r!==""),a=e.pop().replace(".md","");let n=null;if(e.length>0){const r=e[e.length-1];r.toLowerCase()!=="posts"&&(n=r)}x.push({name:"PostPage",params:{collection:n,mdName:a}})}const M=P(()=>m.value.length),B=P(()=>v.value.length);return(o,e)=>(c(),i("div",j,[t("div",z,[e[1]||(e[1]=t("div",{class:"icon-wrapper"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"header-icon"},[t("path",{d:"M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5 .75.75 0 0 0 0 1.5Z"}),t("path",{"fill-rule":"evenodd",d:"M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z","clip-rule":"evenodd"})])],-1)),t("div",W,[e[0]||(e[0]=t("h1",null,"Archive",-1)),t("span",$,"历史文章归档 · "+u(B.value)+" / "+u(M.value),1)])]),t("div",q,[(c(!0),i(H,null,I(v.value,(s,a)=>(c(),i("div",{key:s.url,class:"post-item-wrapper"},[a===0||new Date(s.date).getFullYear()!==new Date(v.value[a-1].date).getFullYear()?(c(),i("div",G,[t("span",J,u(new Date(s.date).getFullYear()),1)])):f("",!0),a===0||new Date(s.date).getMonth()!==new Date(v.value[a-1].date).getMonth()?(c(),i("div",K,[t("span",Q,u(new Date(s.date).toLocaleString("default",{month:"long"})),1)])):f("",!0),t("div",{onClick:n=>D(s.url),class:"post-content post-entry"},[e[3]||(e[3]=t("div",{class:"post-dot"},null,-1)),t("div",ee,[t("h3",null,u(s.title),1),t("p",te,[e[2]||(e[2]=t("svg",{class:"date-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),O(" "+u(s.date),1)])])],8,X)]))),128)),t("div",{ref_key:"loadMoreTrigger",ref:g,class:"load-more-trigger"},[p.value?(c(),i("div",se,e[4]||(e[4]=[t("div",{class:"spinner"},null,-1),t("span",null,"加载中...",-1)]))):h.value?f("",!0):(c(),i("div",ae,[e[5]||(e[5]=t("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",null,"已加载全部 "+u(M.value)+" 篇文章",1)]))],512)])]))}},ie=Y(oe,[["__scopeId","data-v-e6a4b937"]]);export{ie as default};
