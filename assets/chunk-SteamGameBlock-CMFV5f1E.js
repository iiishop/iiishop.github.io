import{r as u,i as d,f as A,b as o,o as l,e as r,G as b,m as $,l as v,t as n,y as x,F as G,k as F,g as L}from"./entry-index-B6sojzRE.js";import{u as M}from"./chunk-color-thief-DF3QbzqH.js";import{_ as j}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib-C3SUPDTN.js";const q={key:0,class:"state-msg"},H={key:1,class:"state-msg error-msg"},N=["href"],V={key:2,class:"card-content"},E={class:"left-col"},O={class:"img-wrapper"},X=["src"],J={key:0,class:"discount-badge"},K={class:"right-col"},Q={class:"game-title"},W=["href"],Y={class:"meta-row"},Z={key:0,class:"release-date"},ee={key:1,class:"review-summary"},se={key:2,class:"review-text"},ae={key:0,class:"tags-row"},te=["innerHTML"],re={class:"action-row"},oe={class:"price-block"},le={key:0,class:"original-price"},ne=["href"],ce={__name:"SteamGameBlock",props:{gameurl:String},setup(T){const p=T,a=u(null),w=u(null),_=u(!0),m=u(!1),k=u(""),P=u(""),C=d(()=>{var e,s,t;return((t=(s=(e=w.value)==null?void 0:e.all)==null?void 0:s.query_summary)==null?void 0:t.review_score_desc)||""}),U=d(()=>{var e,s,t;return((t=(s=(e=w.value)==null?void 0:e.all)==null?void 0:s.query_summary)==null?void 0:t.total_reviews)||0}),z=d(()=>k.value?{background:`linear-gradient(135deg, ${k.value} 0%, rgba(27, 40, 56, 1) 80%)`}:{}),B=d(()=>{var e;return!a.value||!a.value.price_overview?(e=a.value)!=null&&e.is_free?"免费开玩":"":a.value.price_overview.final_formatted}),g=d(()=>{var e;return(e=a.value)!=null&&e.price_overview?a.value.price_overview.discount_percent:0}),h=d(()=>{var t;const e=((t=a.value)==null?void 0:t.header_image)||"";if(!e)return"";const s=e.replace(/^https?:\/\//,"");return`https://images.weserv.nl/?url=${encodeURIComponent(s)}&w=800&output=webp`}),D=e=>{const s=e.match(/\/app\/(\d+)/);return s?s[1]:null},I=async e=>{const s=[t=>`https://corsproxy.io/?${encodeURIComponent(t)}`,t=>`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`];for(const t of s)try{const c=t(e),i=await L.get(c,{headers:{"X-Auth-Token":void 0}});if(i.data)return i.data}catch(c){console.warn(`Proxy request failed: ${c.message}`)}return null},R=async()=>{const e=D(p.gameurl);if(!e){m.value=!0,_.value=!1;return}try{console.log(`Fetching Steam data for AppID: ${e}`);const s=`https://store.steampowered.com/api/appdetails?appids=${e}&cc=cn&l=schinese`,t=`https://store.steampowered.com/appreviews/${e}?json=1&l=schinese&purchase_type=all`,[c,i]=await Promise.all([I(s),I(t)]);if(c&&c[e]&&c[e].success){if(a.value=c[e].data,i&&i.success&&(w.value={all:i}),h.value){const f=new Image;f.crossOrigin="Anonymous",f.src=h.value,f.onload=()=>{try{const y=new M().getPalette(f,2);y&&y.length>=2&&(k.value=`rgb(${y[0].join(",")})`,P.value=`rgb(${y[1].join(",")})`)}catch(S){console.warn("ColorThief failed",S)}}}}else m.value=!0}catch(s){console.error("Steam API Error:",s),m.value=!0}finally{_.value=!1}};return A(()=>{R()}),(e,s)=>(l(),o("div",{class:x(["steam-card",{loading:_.value,error:m.value}]),style:$(z.value)},[_.value?(l(),o("div",q,s[0]||(s[0]=[r("span",{class:"loader"},null,-1),b(" Loading Steam Info... ")]))):m.value?(l(),o("div",H,[s[1]||(s[1]=b(" Failed to load Steam info. ")),r("a",{href:p.gameurl,target:"_blank"},"Click to open store",8,N)])):(l(),o("div",V,[r("div",{class:"bg-blur",style:$({backgroundImage:`url(${h.value})`})},null,4),r("div",E,[r("div",O,[r("img",{src:h.value,alt:"Header",class:"header-img",crossorigin:"anonymous"},null,8,X),g.value>0?(l(),o("div",J,"-"+n(g.value)+"%",1)):v("",!0)])]),r("div",K,[r("h2",Q,[r("a",{href:p.gameurl,target:"_blank"},n(a.value.name),9,W)]),r("div",Y,[a.value.release_date?(l(),o("span",Z,n(a.value.release_date.date),1)):v("",!0),a.value.metacritic?(l(),o("span",ee,[r("span",{class:x(["mc-score",{high:a.value.metacritic.score>=80}])},n(a.value.metacritic.score),3)])):v("",!0),C.value?(l(),o("span",se,n(C.value)+" ("+n(U.value)+") ",1)):v("",!0)]),a.value.genres&&a.value.genres.length?(l(),o("div",ae,[(l(!0),o(G,null,F(a.value.genres.slice(0,4),t=>(l(),o("span",{key:t.id,class:"tag"},n(t.description),1))),128))])):v("",!0),r("div",{class:"game-desc",innerHTML:a.value.short_description},null,8,te),r("div",re,[r("div",oe,[g.value>0&&a.value.price_overview?(l(),o("span",le,n(a.value.price_overview.initial_formatted),1)):v("",!0),r("span",{class:x(["final-price",{discounted:g.value>0}])},n(B.value||"免费"),3)]),r("a",{href:p.gameurl,target:"_blank",class:"store-btn"},s[2]||(s[2]=[r("span",{class:"steam-icon"},[r("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[r("path",{d:"M12 0C5.373 0 0 5.373 0 12c0 3.12 1.18 5.968 3.13 8.146l3.65-5.323c-.16-.628-.242-1.287-.242-1.966 0-4.322 3.504-7.826 7.826-7.826s7.826 3.504 7.826 7.826-3.504 7.826-7.826 7.826c-1.637 0-3.158-.5-4.432-1.353l-3.23 4.706C8.803 23.36 10.347 24 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm2.365 14.887c-1.595 0-2.887-1.292-2.887-2.887s1.292-2.887 2.887-2.887 2.887 1.292 2.887 2.887-1.292 2.887-2.887 2.887zm0-4.226c-.74 0-1.34.6-1.34 1.34s.6 1.34 1.34 1.34 1.34-.6 1.34-1.34-.6-1.34-1.34-1.34zm-7.79 6.208l1.69-2.464c1.17.48 2.45.626 3.65.348l-2.07 3.018c-1.127-.14-2.203-.455-3.27-.902z"})])],-1),b(" 访问商店 ")]),8,ne)])])]))],6))}},me=j(ce,[["__scopeId","data-v-b90235f1"]]);export{me as default};
