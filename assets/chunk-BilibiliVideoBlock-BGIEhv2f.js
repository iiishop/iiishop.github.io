import{r as i,i as b,f as te,b as c,o as d,e as t,m as h,t as v,l as U,G as z,F as S,k as F,y as ae,g as se}from"./entry-index-DzRKx3tS.js";import{_ as oe}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib-BuZcN1zc.js";const le={class:"mood-bg"},re={key:0,class:"state-container"},ne={key:1,class:"state-container error-state"},ie={class:"error-content"},ce=["href"],de={class:"media-column"},ue=["href"],ve={class:"duration-badge"},pe={class:"badge-text"},he={class:"data-column"},me={class:"data-header"},ge={class:"meta-date"},fe={class:"video-title"},_e=["href"],ye={key:0,class:"video-description-deck"},be={class:"deck-content"},ke={class:"stats-matrix"},xe={class:"stat-track"},we={class:"stat-info"},Me={class:"stat-val"},$e={class:"stat-key"},Ie={class:"data-footer"},Be={class:"creator-telemetry"},Se={class:"cyclotron-avatar"},Fe=["src"],Ae={class:"creator-info"},Ce={class:"author-row"},De={class:"author-id"},Le={key:0,class:"fans-badge"},Ee=["title"],Re={class:"fans-count"},Ve={class:"creator-bio"},Te={class:"feedback-sector"},Ne={key:0,class:"honor-rank"},Ue={key:1,class:"system-status"},ze={class:"micro-tags"},Pe={class:"particle-field"},Xe={__name:"BilibiliVideoBlock",props:{videourl:String},setup(P){const $=P,u=i(null),p=i(null),k=i(!0),f=i(!1),m=i(""),A=i(""),C=i("#FB7299"),D=i("#FF8FB3"),L=i("#23ADE5"),E=["#6B7280","#4AA9FF","#23BDB0","#44D07A","#FFD166","#FF8B4B","#FF4B4B"],X=a=>{const e=a.replace("#",""),s=parseInt(e,16);return[s>>16&255,s>>8&255,s&255]},Y=(a,e,s)=>.299*a+.587*e+.114*s,R=b(()=>{if(!(p!=null&&p.value))return E[0];const a=Math.max(0,Math.min(6,Number(p.value.level||0)));return E[a]}),O=b(()=>{const[a,e,s]=X(R.value);return Y(a,e,s)>160?"#000000":"#FFFFFF"}),I=i(null),x=i(0),w=i(0),_=i(!1),G=a=>{if(!I.value)return;const e=I.value.getBoundingClientRect();x.value=(a.clientX-e.left)/e.width-.5,w.value=(a.clientY-e.top)/e.height-.5},q=()=>{_.value=!0},H=()=>{_.value=!1,x.value=0,w.value=0},K=b(()=>{const a=_.value?w.value*-5:0,e=_.value?x.value*5:0;return{transform:`perspective(1000px) rotateX(${a}deg) rotateY(${e}deg)`}}),Z=a=>{const e=a.match(/BV[a-zA-Z0-9]+/);return e?e[0]:null},y=a=>{if(!a&&a!==0)return{display:"0",raw:0};const e=a;let s="";return a>=1e8?s=(a/1e8).toFixed(1)+"亿":a>=1e4?s=(a/1e4).toFixed(1)+"万":s=a.toString(),{display:s,raw:e}},j=a=>{const e=Math.floor(a/3600),s=Math.floor(a%3600/60),o=a%60;return e>0?`${e}:${String(s).padStart(2,"0")}:${String(o).padStart(2,"0")}`:`${s}:${String(o).padStart(2,"0")}`},J=a=>new Date(a*1e3).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"."),V=b(()=>$.videourl),Q=b(()=>{var s;if(!((s=u.value)!=null&&s.stat))return[];const a=u.value.stat,e=a.view||1;return[{label:"PLAYS",...y(a.view),percent:100},{label:"LIKES",...y(a.like),percent:Math.min(a.like/e*100,100)},{label:"COINS",...y(a.coin),percent:Math.min(a.coin/e*100,100)},{label:"FAVS",...y(a.favorite),percent:Math.min(a.favorite/e*100,100)}]}),T=async a=>{const e=[s=>`https://api.allorigins.win/raw?url=${encodeURIComponent(s)}`,s=>`https://corsproxy.io/?${encodeURIComponent(s)}`,s=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(s)}`];for(const s of e)try{const o=s(a),r=await se.get(o,{headers:{"X-Auth-Token":void 0}});if(r.data)return r.data}catch(o){console.warn(`Proxy request failed for ${a}: ${o.message}`)}return null},W=async()=>{var e;const a=Z($.videourl);if(!a){f.value=!0,k.value=!1;return}try{const s=`https://api.bilibili.com/x/web-interface/view?bvid=${a}`,o=await T(s);if(o&&o.code===0&&o.data){u.value=o.data;const l=`https://api.bilibili.com/x/web-interface/card?mid=${o.data.owner.mid}`,n=await T(l);n&&n.code===0&&(p.value={follower:n.data.follower,level:n.data.card.level_info.current_level,sign:n.data.card.sign}),o.data.pic&&(m.value=`https://images.weserv.nl/?url=${encodeURIComponent(o.data.pic.replace(/^https?:\/\//,""))}`),(e=o.data.owner)!=null&&e.face&&(A.value=`https://images.weserv.nl/?url=${encodeURIComponent(o.data.owner.face.replace(/^https?:\/\//,""))}`),ee()}else f.value=!0}catch(s){console.error("Bilibili API Error:",s),f.value=!0}finally{k.value=!1}},ee=()=>{if(!m.value)return;const a=new Image;a.crossOrigin="anonymous",a.src=m.value,a.onload=()=>{try{const e=document.createElement("canvas"),s=e.getContext("2d");e.width=50,e.height=50,s.drawImage(a,0,0,50,50);const o=s.getImageData(0,0,50,50).data;let r=0,l=0,n=0;const M=100;for(let g=0;g<M;g++){const B=Math.floor(Math.random()*(o.length/4))*4;r+=o[B],l+=o[B+1],n+=o[B+2]}r=Math.floor(r/M),l=Math.floor(l/M),n=Math.floor(n/M);const N=(r+l+n)/3;if(N<60){const g=60-N;r=Math.min(r+g,255),l=Math.min(l+g,255),n=Math.min(n+g,255)}C.value=`rgb(${r}, ${l}, ${n})`,D.value=`rgb(${Math.min(r+60,255)}, ${Math.min(l+30,255)}, ${Math.min(n+90,255)})`,L.value=`rgb(${Math.max(r-40,0)}, ${Math.min(l+80,255)}, ${Math.max(n-20,0)})`}catch(e){console.warn(e)}}};return te(()=>W()),(a,e)=>{var s,o,r;return d(),c("article",{class:ae(["bili-embed-neo",{"is-loading":k.value,"is-error":f.value,"is-hovering":_.value}]),ref_key:"cardRef",ref:I,onMousemove:G,onMouseenter:q,onMouseleave:H,style:h({"--theme-primary":C.value,"--theme-accent":D.value,"--theme-secondary":L.value,"--mouse-x":x.value,"--mouse-y":w.value})},[t("div",le,[t("div",{class:"bg-layer base-blur",style:h({backgroundImage:`url(${m.value})`})},null,4),t("div",{class:"bg-layer drift-blur",style:h({backgroundImage:`url(${m.value})`})},null,4),e[0]||(e[0]=t("div",{class:"noise-overlay"},null,-1)),e[1]||(e[1]=t("div",{class:"overlay-gradient"},null,-1))]),k.value?(d(),c("div",re,e[2]||(e[2]=[t("div",{class:"cyber-loader"},[t("div",{class:"glitch-box"})],-1)]))):f.value?(d(),c("div",ne,[t("div",ie,[e[3]||(e[3]=t("span",{class:"error-code"},"404::SIGNAL_LOST",-1)),t("a",{href:$.videourl,target:"_blank",class:"error-link"},"MANUAL_OVERRIDE",8,ce)])])):(d(),c("div",{key:2,class:"bili-card-glass",style:h(K.value)},[e[13]||(e[13]=t("div",{class:"glass-shine"},null,-1)),t("div",de,[t("a",{href:V.value,target:"_blank",class:"cover-wrapper"},[t("div",{class:"glitch-layer layer-r",style:h({backgroundImage:`url(${m.value})`})},null,4),t("div",{class:"glitch-layer layer-b",style:h({backgroundImage:`url(${m.value})`})},null,4),t("div",{class:"glitch-layer layer-main",style:h({backgroundImage:`url(${m.value})`})},null,4),e[5]||(e[5]=t("div",{class:"play-overlay"},[t("div",{class:"play-button-hex"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M8 5v14l11-7z"})])])],-1)),t("div",ve,[e[4]||(e[4]=t("span",{class:"badge-blur"},null,-1)),t("span",pe,v(j(u.value.duration)),1)])],8,ue)]),t("div",he,[t("header",me,[e[6]||(e[6]=t("div",{class:"platform-chip"},[t("span",{class:"dot"}),z("BILIBILI.V2")],-1)),t("time",ge,v(J(u.value.pubdate)),1)]),t("h3",fe,[t("a",{href:V.value,target:"_blank"},v(u.value.title),9,_e)]),u.value.desc?(d(),c("div",ye,[e[7]||(e[7]=t("div",{class:"deck-bracket"},null,-1)),t("p",be,v(u.value.desc),1)])):U("",!0),t("div",ke,[(d(!0),c(S,null,F(Q.value,l=>(d(),c("div",{class:"stat-cell",key:l.label},[t("div",xe,[t("div",{class:"stat-bar",style:h({width:l.percent+"%"})},null,4)]),t("div",we,[t("span",Me,v(l.display),1),t("span",$e,v(l.label),1)])]))),128))]),t("footer",Ie,[t("div",Be,[t("div",Se,[e[8]||(e[8]=t("div",{class:"orbit-ring"},null,-1)),e[9]||(e[9]=t("div",{class:"orbit-ring-outer"},null,-1)),t("img",{src:A.value,class:"author-face"},null,8,Fe),e[10]||(e[10]=t("div",{class:"scan-line"},null,-1))]),t("div",Ae,[t("div",Ce,[t("span",De,v(u.value.owner.name),1),p.value?(d(),c("div",Le,[t("span",{class:"fans-label",style:h({background:R.value,color:O.value}),title:"Level "+(p.value.level??0)},"LV."+v(p.value.level),13,Ee),t("span",Re,v(y(p.value.follower).display)+" 粉丝",1)])):U("",!0)]),t("div",Ve,v(((s=p.value)==null?void 0:s.sign)||"DATA_STREAM::STABILIZED"),1)])]),t("div",Te,[(o=u.value.honor_reply)!=null&&o.honor?(d(),c("div",Ne,[e[11]||(e[11]=t("span",{class:"rank-icon"},null,-1)),z(" "+v(u.value.honor_reply.honor[0].desc),1)])):(d(),c("div",Ue,e[12]||(e[12]=[t("div",{class:"status-pip ripple"},null,-1),t("span",{class:"status-msg"},"LINK_ESTABLISHED",-1)]))),t("div",ze,[(d(!0),c(S,null,F((r=u.value.tags)==null?void 0:r.slice(0,2),l=>(d(),c("span",{key:l.tag_id,class:"micro-tag"},v(l.tag_name),1))),128))])])])]),t("div",Pe,[(d(),c(S,null,F(5,l=>t("div",{key:l,class:"particle",style:h({"--delay":l+"s","--pos":l*20+"%"})},null,4)),64))])],4))],38)}}},qe=oe(Xe,[["__scopeId","data-v-9ed9dc65"]]);export{qe as default};
