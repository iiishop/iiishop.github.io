import{r as u,c as d,o as A,b as o,d as l,f as t,p as b,z as $,v,t as c,n as x,F,h as G,k as L}from"./index-E8b4J8RI.js";import{u as M}from"./color-thief-DF3QbzqH.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={key:0,class:"state-msg"},H={key:1,class:"state-msg error-msg"},N=["href"],V={key:2,class:"card-content"},E={class:"left-col"},O={class:"img-wrapper"},J=["src"],K={key:0,class:"discount-badge"},Q={class:"right-col"},W={class:"game-title"},X=["href"],Y={class:"meta-row"},Z={key:0,class:"release-date"},ee={key:1,class:"review-summary"},se={key:2,class:"review-text"},ae={key:0,class:"tags-row"},te=["innerHTML"],re={class:"action-row"},oe={class:"price-block"},le={key:0,class:"original-price"},ce=["href"],ne={__name:"SteamGameBlock",props:{gameurl:String},setup(z){const p=z,a=u(null),w=u(null),_=u(!0),m=u(!1),k=u(""),P=u(""),C=d(()=>{var e,s,r;return((r=(s=(e=w.value)==null?void 0:e.all)==null?void 0:s.query_summary)==null?void 0:r.review_score_desc)||""}),T=d(()=>{var e,s,r;return((r=(s=(e=w.value)==null?void 0:e.all)==null?void 0:s.query_summary)==null?void 0:r.total_reviews)||0}),B=d(()=>k.value?{background:`linear-gradient(135deg, ${k.value} 0%, rgba(27, 40, 56, 1) 80%)`}:{}),D=d(()=>{var e;return!a.value||!a.value.price_overview?(e=a.value)!=null&&e.is_free?"免费开玩":"":a.value.price_overview.final_formatted}),g=d(()=>{var e;return(e=a.value)!=null&&e.price_overview?a.value.price_overview.discount_percent:0}),h=d(()=>{var e;return((e=a.value)==null?void 0:e.header_image)||""}),U=e=>{const s=e.match(/\/app\/(\d+)/);return s?s[1]:null},I=async e=>{const s=[r=>`https://corsproxy.io/?${encodeURIComponent(r)}`,r=>`https://api.allorigins.win/raw?url=${encodeURIComponent(r)}`];for(const r of s)try{const n=r(e),i=await L.get(n);if(i.data)return i.data}catch(n){console.warn(`Proxy request failed: ${n.message}`)}return null},R=async()=>{const e=U(p.gameurl);if(!e){m.value=!0,_.value=!1;return}try{console.log(`Fetching Steam data for AppID: ${e}`);const s=`https://store.steampowered.com/api/appdetails?appids=${e}&cc=cn&l=schinese`,r=`https://store.steampowered.com/appreviews/${e}?json=1&l=schinese&purchase_type=all`,[n,i]=await Promise.all([I(s),I(r)]);if(n&&n[e]&&n[e].success){if(a.value=n[e].data,i&&i.success&&(w.value={all:i}),h.value){const f=new Image;f.crossOrigin="Anonymous",f.src=h.value,f.onload=()=>{try{const y=new M().getPalette(f,2);y&&y.length>=2&&(k.value=`rgb(${y[0].join(",")})`,P.value=`rgb(${y[1].join(",")})`)}catch(S){console.warn("ColorThief failed",S)}}}}else m.value=!0}catch(s){console.error("Steam API Error:",s),m.value=!0}finally{_.value=!1}};return A(()=>{R()}),(e,s)=>(l(),o("div",{class:x(["steam-card",{loading:_.value,error:m.value}]),style:$(B.value)},[_.value?(l(),o("div",q,s[0]||(s[0]=[t("span",{class:"loader"},null,-1),b(" Loading Steam Info... ")]))):m.value?(l(),o("div",H,[s[1]||(s[1]=b(" Failed to load Steam info. ")),t("a",{href:p.gameurl,target:"_blank"},"Click to open store",8,N)])):(l(),o("div",V,[t("div",{class:"bg-blur",style:$({backgroundImage:`url(${h.value})`})},null,4),t("div",E,[t("div",O,[t("img",{src:h.value,alt:"Header",class:"header-img"},null,8,J),g.value>0?(l(),o("div",K,"-"+c(g.value)+"%",1)):v("",!0)])]),t("div",Q,[t("h2",W,[t("a",{href:p.gameurl,target:"_blank"},c(a.value.name),9,X)]),t("div",Y,[a.value.release_date?(l(),o("span",Z,c(a.value.release_date.date),1)):v("",!0),a.value.metacritic?(l(),o("span",ee,[t("span",{class:x(["mc-score",{high:a.value.metacritic.score>=80}])},c(a.value.metacritic.score),3)])):v("",!0),C.value?(l(),o("span",se,c(C.value)+" ("+c(T.value)+") ",1)):v("",!0)]),a.value.genres&&a.value.genres.length?(l(),o("div",ae,[(l(!0),o(F,null,G(a.value.genres.slice(0,4),r=>(l(),o("span",{key:r.id,class:"tag"},c(r.description),1))),128))])):v("",!0),t("div",{class:"game-desc",innerHTML:a.value.short_description},null,8,te),t("div",re,[t("div",oe,[g.value>0&&a.value.price_overview?(l(),o("span",le,c(a.value.price_overview.initial_formatted),1)):v("",!0),t("span",{class:x(["final-price",{discounted:g.value>0}])},c(D.value||"免费"),3)]),t("a",{href:p.gameurl,target:"_blank",class:"store-btn"},s[2]||(s[2]=[t("span",{class:"steam-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[t("path",{d:"M12 0C5.373 0 0 5.373 0 12c0 3.12 1.18 5.968 3.13 8.146l3.65-5.323c-.16-.628-.242-1.287-.242-1.966 0-4.322 3.504-7.826 7.826-7.826s7.826 3.504 7.826 7.826-3.504 7.826-7.826 7.826c-1.637 0-3.158-.5-4.432-1.353l-3.23 4.706C8.803 23.36 10.347 24 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm2.365 14.887c-1.595 0-2.887-1.292-2.887-2.887s1.292-2.887 2.887-2.887 2.887 1.292 2.887 2.887-1.292 2.887-2.887 2.887zm0-4.226c-.74 0-1.34.6-1.34 1.34s.6 1.34 1.34 1.34 1.34-.6 1.34-1.34-.6-1.34-1.34-1.34zm-7.79 6.208l1.69-2.464c1.17.48 2.45.626 3.65.348l-2.07 3.018c-1.127-.14-2.203-.455-3.27-.902z"})])],-1),b(" 访问商店 ")]),8,ce)])])]))],6))}},ve=j(ne,[["__scopeId","data-v-985b080d"]]);export{ve as default};
