import{C as $,r as f,f as S,v as E,b as k,o as I,e as g,t as C,m as _}from"./entry-index-B6sojzRE.js";import{g as y}from"./chunk-index-D-nlVayj.js";import{_ as D}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib-C3SUPDTN.js";const R=["src"],U={class:"info"},B={__name:"Collection",props:{name:String,imageUrl:String,createDate:String,count:Number},setup(s){const u=s,b=$(),m=f({}),p=f(!1);f(null);const N=e=>{if(p.value)return;p.value=!0,console.log("[Collection] Navigating to CollectionsPage with:",u.name);const a=e.currentTarget,o=a.getBoundingClientRect(),t=document.createElement("div");t.className="collection-transition",Object.assign(t.style,{position:"fixed",top:`${o.top}px`,left:`${o.left}px`,width:`${o.width}px`,height:`${o.height}px`,background:m.value.backgroundColor||"rgba(102, 126, 234, 0.4)",borderRadius:"1rem",zIndex:"9999",pointerEvents:"none",transformOrigin:"center center",overflow:"hidden",perspective:"2000px"});const d=a.cloneNode(!0);d.style.cssText="width: 100%; height: 100%; transform: none; box-shadow: none;",t.appendChild(d),document.body.appendChild(t);const c=y.timeline({onComplete:()=>{b.push({name:"Collections",query:{open:u.name}}).then(()=>{console.log("[Collection] Navigation successful"),y.to(t,{opacity:0,duration:.3,onComplete:()=>{t.parentNode&&t.parentNode.removeChild(t),p.value=!1}})}).catch(n=>{console.error("[Collection] Navigation failed:",n),t.parentNode&&t.parentNode.removeChild(t),p.value=!1})}}),l=window.innerWidth/2,h=window.innerHeight/2,w=Math.min(window.innerWidth/o.width,window.innerHeight/o.height)*.8;c.to(t,{x:l-o.left-o.width/2,y:h-o.top-o.height/2,scale:w,opacity:.95,duration:.5,ease:"power2.out"}),c.to(t,{rotationY:90,duration:.4,ease:"power2.inOut"},"+=0.1"),c.to(t,{top:0,left:0,width:"100vw",height:"100vh",borderRadius:0,x:0,y:0,scale:1,duration:.2,ease:"none"},"-=0.2")},v=e=>new Promise((a,o)=>{const t=document.createElement("canvas"),d=t.getContext("2d");e.onload=()=>{try{t.width=e.width,t.height=e.height,d.drawImage(e,0,0,e.width,e.height);const c=d.getImageData(0,0,e.width,e.height).data,l=[];let h=0;for(let n=0;n<c.length;n+=4){const r=c[n],i=c[n+1],x=c[n+2];r>=204&&i>=204&&x>=204?h++:l.push([r,i,x])}const w=e.width*e.height;if(h<w/2){const n=l.reduce((r,i)=>[r[0]+i[0],r[1]+i[1],r[2]+i[2]],[0,0,0]).map(r=>Math.round(r/l.length));a(`rgba(${n[0]}, ${n[1]}, ${n[2]}, 0.4)`)}else{const n=l.concat(Array(h).fill([255,255,255])).reduce((r,i)=>[r[0]+i[0],r[1]+i[1],r[2]+i[2]],[0,0,0]).map(r=>Math.round(r/w));a(`rgba(${n[0]}, ${n[1]}, ${n[2]}, 0.4)`)}}catch(c){console.warn("Cannot extract color from image (CORS):",c),a("rgba(102, 126, 234, 0.4)")}},e.onerror=()=>{console.warn("Error loading image for color extraction"),a("rgba(102, 126, 234, 0.4)")},e.src=u.imageUrl});return S(async()=>{const e=new Image;try{const a=await v(e);m.value={backgroundColor:a}}catch(a){console.error("Error loading image:",a)}}),E(()=>u.imageUrl,async e=>{const a=new Image;try{const o=await v(a);m.value={backgroundColor:o}}catch(o){console.error("Error loading image:",o)}}),(e,a)=>(I(),k("div",{class:"collection",style:_(m.value),onClick:N},[g("img",{src:s.imageUrl},null,8,R),g("div",U,[g("h2",null,C(s.name),1),g("p",null,C(s.createDate),1),g("p",null,"内有"+C(s.count)+"篇文章",1)])],4))}},T=D(B,[["__scopeId","data-v-73c95e01"]]);export{T as default};
