const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-SteamGameBlock-Bu6Y9kHh.js","assets/entry-index-CVwcNbOi.js","assets/chunk-mermaid-lib-CtMrMl2-.js","assets/asset-index-DQTw5x8l.css","assets/chunk-color-thief-DF3QbzqH.js","assets/chunk-_plugin-vue_export-helper-DlAUqK2U.js","assets/asset-SteamGameBlock-B-ltQF1U.css","assets/chunk-BangumiBlock-DQC7nt9T.js","assets/asset-BangumiBlock-CZgwujlY.css","assets/chunk-BilibiliVideoBlock-D6RZL0QM.js","assets/asset-BilibiliVideoBlock-DE3SKqHY.css","assets/chunk-GithubRepoBlock-VwM84b2Q.js","assets/asset-GithubRepoBlock-CkND9FTr.css","assets/chunk-XiaohongshuNoteBlock-DNAao50Q.js","assets/asset-XiaohongshuNoteBlock-C8nWHP7E.css"])))=>i.map(i=>d[i]);
import{an as L,_ as w}from"./chunk-mermaid-lib-CtMrMl2-.js";import{r as u,i as S,A as ae,f as oe,j as se,B as ne,b as m,o as h,e as s,q as g,a as k,l as O,t as f,w as I,y as U,F as le,m as re,G as ie,g as ce,p as de,n as B,d as C}from"./entry-index-CVwcNbOi.js";import{f as ue}from"./chunk-index-Dy4cVkSp.js";import{m as me}from"./chunk-MarkdownRenender-B6HGnk-U.js";import{r as he}from"./chunk-DynamicComponentRenderer-DtgdFYq_.js";import ve from"./chunk-IconCategory-Dhw5axz0.js";import ge from"./chunk-IconDate-DyL7Ac_k.js";import{_ as pe}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"image-container"},fe=["src"],ye={class:"overlay"},we={class:"header-content"},ke={class:"post-title"},Ce={class:"meta-info"},Me={key:0,class:"category-panel"},be={key:1,class:"meta-divider"},xe={key:2,class:"date-panel"},$e={key:0,class:"article-stats"},Te={class:"stat-item"},Se={class:"stat-content"},Ae={class:"stat-value"},Pe={class:"stat-item"},Ee={class:"stat-content"},Le={class:"stat-value"},Ie={key:0,class:"stat-divider"},Be={key:1,class:"stat-item stat-tags"},De={class:"stat-content"},Re={class:"tags-container"},Ve=["innerHTML"],He={__name:"MarkdownPanel",props:{markdownUrl:{type:String,required:!0},decryptedContent:{type:String,default:null}},setup(F){const G=C(()=>w(()=>import("./chunk-SteamGameBlock-Bu6Y9kHh.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),j=C(()=>w(()=>import("./chunk-BangumiBlock-DQC7nt9T.js"),__vite__mapDeps([7,1,2,3,4,5,8]))),z=C(()=>w(()=>import("./chunk-BilibiliVideoBlock-D6RZL0QM.js"),__vite__mapDeps([9,1,2,3,5,10]))),K=C(()=>w(()=>import("./chunk-GithubRepoBlock-VwM84b2Q.js"),__vite__mapDeps([11,1,2,3,5,12]))),Y=C(()=>w(()=>import("./chunk-XiaohongshuNoteBlock-DNAao50Q.js"),__vite__mapDeps([13,1,2,3,5,14]))),M=F,a=u({}),A=u(""),b=u(null),D=u(null),R=u(null),V=u(null),P=u(0),H=u(!1),x=u({h:210,s:70,l:55}),y=u({h:220,s:65,l:50}),$=u({wordCount:0,readingTime:0}),W=S(()=>{const{h:o,s:e,l:t}=x.value,{h:n,s:l,l:i}=y.value;return{"--primary-hue":o,"--primary-sat":e+"%","--primary-light":t+"%","--accent-hue":n,"--accent-sat":l+"%","--accent-light":i+"%","--primary-color":`hsl(${o}, ${e}%, ${t}%)`,"--primary-light-color":`hsl(${o}, ${e}%, ${Math.min(t+15,85)}%)`,"--primary-dark-color":`hsl(${o}, ${e}%, ${Math.max(t-15,20)})`,"--accent-color":`hsl(${n}, ${l}%, ${i}%)`,"--gradient":`linear-gradient(135deg, hsl(${o}, ${e}%, ${t}%) 0%, hsl(${n}, ${l}%, ${i}%) 100%)`}}),X=o=>{const t=o.replace(/<[^>]*>/g,"").replace(/\s+/g,"").length,n=Math.ceil(t/300);$.value={wordCount:t,readingTime:n}},J=()=>{var n;const o=(n=R.value)==null?void 0:n.querySelector(".header-image"),e=V.value;if(!o||!e)return;const t=e.getContext("2d");e.width=o.width,e.height=o.height;try{t.drawImage(o,0,0,e.width,e.height);const l=t.getImageData(0,0,e.width,e.height).data,i=new Map;for(let r=0;r<l.length;r+=40){const v=l[r],d=l[r+1],c=l[r+2];if(l[r+3]<128||v>240&&d>240&&c>240||v<15&&d<15&&c<15)continue;const p=Q(v,d,c);if(p.s>20){const T=`${Math.round(p.h/10)*10}-${Math.round(p.s/10)*10}`;i.set(T,(i.get(T)||0)+1)}}if(i.size>0){const r=Array.from(i.entries()).sort((_,p)=>p[1]-_[1]),[v]=r[0],[d,c]=v.split("-").map(Number);if(x.value={h:d,s:Math.min(c+10,80),l:55},r.length>1){const[_]=r[1],[p,T]=_.split("-").map(Number);y.value={h:p,s:Math.min(T+5,75),l:50}}else y.value={h:(d+30)%360,s:Math.min(c+5,75),l:50}}}catch(l){console.warn("无法提取图片颜色，使用默认配色:",l),x.value={h:210,s:70,l:55},y.value={h:220,s:65,l:50}}},Q=(o,e,t)=>{o/=255,e/=255,t/=255;const n=Math.max(o,e,t),l=Math.min(o,e,t);let i,r,v=(n+l)/2;if(n===l)i=r=0;else{const d=n-l;switch(r=v>.5?d/(2-n-l):d/(n+l),n){case o:i=((e-t)/d+(e<t?6:0))/6;break;case e:i=((t-o)/d+2)/6;break;case t:i=((o-e)/d+4)/6;break}}return{h:Math.round(i*360),s:Math.round(r*100),l:Math.round(v*100)}},N=()=>{if(!D.value||!b.value)return;const o=b.value.offsetTop,e=b.value.scrollHeight,t=window.innerHeight,n=window.scrollY,l=n-o,i=e-t,r=Math.min(Math.max(l/i*100,0),100);P.value=r,H.value=n>500},Z=()=>{window.scrollTo({top:0,behavior:"smooth"})},q=async(o,e=null)=>{try{let t;e?(t=e,console.log("使用解密后的内容")):t=(await ce.get(o)).data;const{body:n}=ue(t),{meta:l}=await de(t);a.value=l,a.value.img&&(a.value.img=`/Posts/Images/${a.value.img}`);const i=new Date(a.value.date),r=i.getHours();a.value.date=i.toLocaleDateString().replace(/\//g,"月").replace("月","年")+"日",r<6?a.value.date+=" 凌晨":r<12?a.value.date+=" 上午":r<18?a.value.date+=" 下午":a.value.date+=" 晚上",A.value=me.render(n),X(A.value),await B();const v=document.querySelector(".post-content.markdown");if(he(v,{steamgameblock:G,bangumiblock:j,bilibilivideoblock:z,githubrepoblock:K,xiaohongshunoteblock:Y}),await B(),typeof L<"u")try{L.mermaidAPI.reset(),await L.run({nodes:document.querySelectorAll(".mermaid")}),await B(),document.querySelectorAll(".mermaid svg").forEach(c=>{if(c.removeAttribute("width"),c.removeAttribute("height"),c.style.width="100%",c.style.height="400px",c.style.maxWidth="100%",c.style.maxHeight="400px",c.style.display="block",c.style.margin="0 auto",c.getAttribute("style")){const _=c.getAttribute("style");c.setAttribute("style",_.replace(/max-width:\s*\d+px;?/gi,""))}})}catch(d){console.warn("Mermaid rendering failed:",d)}}catch(t){console.error("Error fetching or parsing markdown file:",t)}};ae(()=>[M.markdownUrl,M.decryptedContent],([o,e])=>{q(o,e),P.value=0,x.value={h:210,s:70,l:55},y.value={h:220,s:65,l:50}},{immediate:!0}),oe(()=>{q(M.markdownUrl,M.decryptedContent),window.addEventListener("scroll",N)}),se(()=>{window.removeEventListener("scroll",N)});const E=S(()=>a.value.categories&&a.value.categories.length>0?a.value.categories[a.value.categories.length-1]:""),ee=S(()=>a.value.categories&&a.value.categories.length>0?{name:"CategoryPage",params:{fullPath:a.value.categories.join("/")}}:"#"),te=S(()=>({name:"ArchivePage"}));return(o,e)=>{const t=ne("router-link");return h(),m("div",{class:"MarkdownPanel",ref_key:"panelRef",ref:b,style:O(W.value)},[s("div",{class:"reading-progress",style:O({width:P.value+"%"})},null,4),s("div",{class:"post-header",ref_key:"headerRef",ref:R},[s("div",_e,[a.value.img?(h(),m("img",{key:0,src:a.value.img,alt:"Post Image",class:"header-image",crossorigin:"anonymous",onLoad:J},null,40,fe)):g("",!0),s("canvas",{ref_key:"colorCanvas",ref:V,style:{display:"none"}},null,512),s("div",ye,[s("div",we,[s("h1",ke,f(a.value.title),1),s("div",Ce,[E.value?(h(),m("div",Me,[k(ve,{style:{width:"1rem",height:"1rem"}}),k(t,{to:ee.value},{default:I(()=>[U(f(E.value),1)]),_:1},8,["to"])])):g("",!0),E.value&&a.value.date?(h(),m("span",be,"•")):g("",!0),a.value.date?(h(),m("div",xe,[k(ge,{style:{width:"1rem",height:"1rem"}}),k(t,{to:te.value},{default:I(()=>[U(f(a.value.date),1)]),_:1},8,["to"])])):g("",!0)])])])])],512),$.value.wordCount>0?(h(),m("div",$e,[s("div",Te,[s("div",Se,[e[0]||(e[0]=s("span",{class:"stat-label"},"字数",-1)),s("span",Ae,f($.value.wordCount.toLocaleString()),1)])]),e[3]||(e[3]=s("div",{class:"stat-divider"},null,-1)),s("div",Pe,[s("div",Ee,[e[1]||(e[1]=s("span",{class:"stat-label"},"阅读时间",-1)),s("span",Le,f($.value.readingTime)+" 分钟",1)])]),a.value.tags&&a.value.tags.length>0?(h(),m("div",Ie)):g("",!0),a.value.tags&&a.value.tags.length>0?(h(),m("div",Be,[s("div",De,[e[2]||(e[2]=s("span",{class:"stat-label"},"标签",-1)),s("div",Re,[(h(!0),m(le,null,re(a.value.tags,n=>(h(),m("span",{key:n,class:"tag"},f(n),1))),128))])])])):g("",!0)])):g("",!0),s("article",{class:"post-content markdown",ref_key:"contentRef",ref:D},[s("div",{innerHTML:A.value},null,8,Ve)],512),k(ie,{name:"fade"},{default:I(()=>[H.value?(h(),m("button",{key:0,class:"back-to-top",onClick:Z},e[4]||(e[4]=[s("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M12 19V5M5 12l7-7 7 7"})],-1)]))):g("",!0)]),_:1})],4)}}},Ke=pe(He,[["__scopeId","data-v-8da7c5f7"]]);export{Ke as default};
