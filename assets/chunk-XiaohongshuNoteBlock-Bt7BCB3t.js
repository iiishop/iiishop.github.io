import{r as l,i as w,f as be,b as d,o as v,e as s,m as x,l as ee,G as we,t as p,F as te,k as se,y as xe,g as Ie}from"./entry-index-DYwYFgky.js";import{_ as Se}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib--N4Maba6.js";const Ce={class:"atmosphere-bg"},Te={key:0,class:"state-layer skeleton"},Ee={key:1,class:"state-layer error"},De=["href"],Ne=["href"],$e={class:"media-container"},Ae={key:0,class:"type-badge"},Me={class:"content-area"},qe={class:"xhs-header"},Re={class:"note-id"},Fe={class:"note-title"},Le=["href"],Ue=["innerHTML","aria-label"],Oe={key:0,class:"chips-row"},Be={class:"chips-left"},He=["href"],Xe={class:"meta-footer"},Pe={class:"user-block"},ze=["src"],Ve={class:"user-name"},Ye={class:"stats-row"},je={class:"icon"},Ge={class:"val"},Je={__name:"XiaohongshuNoteBlock",props:{noteurl:String},setup(ae){const m=ae,i=l(null),I=l(!0),g=l(!1),h=l(""),E=l(""),D=l("#FF2442"),N=l("#FF899E");l("#FFD1D9");const S=l(null),C=l(0),T=l(0),f=l(!1),ne=t=>{if(!S.value)return;const e=S.value.getBoundingClientRect();C.value=(t.clientX-e.left)/e.width-.5,T.value=(t.clientY-e.top)/e.height-.5},oe=()=>{f.value=!0},re=()=>{f.value=!1,C.value=0,T.value=0},le=w(()=>{const t=f.value?T.value*-3:0,e=f.value?C.value*3:0;return{transform:`perspective(1000px) rotateX(${t}deg) rotateY(${e}deg)`}}),$=t=>!t&&t!==0?"0":t>=1e4?(t/1e4).toFixed(1)+"w":t>=1e3?(t/1e3).toFixed(1)+"k":t.toString(),ce=async t=>{const e=[n=>`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`,n=>`https://corsproxy.io/?${encodeURIComponent(n)}`,n=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(n)}`];for(const n of e)try{const a=n(t),r=await Ie.get(a,{headers:{"X-Auth-Token":void 0}});if(r.data)return r.data}catch(a){console.warn(`Proxy request failed: ${a.message}`)}return null},ie=t=>{if(!t)return null;try{const a=new URL(t).pathname.split("/").filter(Boolean),r=a[a.length-1];if(r&&r.length>=24)return r}catch{}const e=t.match(/[a-f0-9]{24}/i);return e?e[0]:null},ue=t=>{var e,n,a,r,_,R,F,L,U,O,B,H,X,P,z,V,Y,j,G,J,K;try{const c=new DOMParser().parseFromString(t,"text/html"),fe=c.querySelectorAll("script");let y=null;for(const k of fe){const o=k.textContent;if(o.includes("__INITIAL_STATE__")){const u=o.match(/window\.__INITIAL_STATE__\s*=\s*(\{.*?\})\s*(?:;|$)/s)||o.match(/__INITIAL_STATE__\s*=\s*(\{.*?\})\s*(?:;|$)/s);if(u&&u[1])try{const b=u[1].replace(/undefined/g,"null");y=JSON.parse(b);break}catch{}}}if(y&&y.note){const k=y.note.noteDetailMap;let o=null;if(k&&(o=(e=Object.values(k)[0])==null?void 0:e.note),o||(o=y.note.note),o){const u=o.user||{},b=u.nickname||u.nickName||u.name||"RED.User",ke=u.avatar||((n=u.avatarContent)==null?void 0:n.urlDefault)||u.image||"";return{title:o.title||((a=o.desc)==null?void 0:a.slice(0,24))||"RED.Note",desc:o.desc||"",type:o.type||"normal",user:{nickname:b,avatar:ke},stats:{likes:((r=o.interactInfo)==null?void 0:r.likedCount)||((_=o.interactInfo)==null?void 0:_.likeCount)||0,collects:((R=o.interactInfo)==null?void 0:R.collectedCount)||((F=o.interactInfo)==null?void 0:F.collectCount)||0,comments:((L=o.interactInfo)==null?void 0:L.commentCount)||0},cover:((O=(U=o.imageList)==null?void 0:U[0])==null?void 0:O.urlDefault)||((B=o.cover)==null?void 0:B.urlDefault)||""}}}const W=((H=c.querySelector('meta[property="og:title"]'))==null?void 0:H.content)||((X=c.querySelector('meta[name="og:title"]'))==null?void 0:X.content)||((P=c.querySelector("title"))==null?void 0:P.innerText),Q=((z=c.querySelector('meta[property="og:image"]'))==null?void 0:z.content)||((V=c.querySelector('meta[name="og:image"]'))==null?void 0:V.content),_e=((Y=c.querySelector('meta[property="og:description"]'))==null?void 0:Y.content)||((j=c.querySelector('meta[name="description"]'))==null?void 0:j.content),ye=((G=c.querySelector(".nickname"))==null?void 0:G.innerText)||((J=c.querySelector(".user-name"))==null?void 0:J.innerText)||((K=c.querySelector('meta[name="author"]'))==null?void 0:K.content)||"RED.User";if(W&&Q)return{title:W,desc:_e,type:"normal",user:{nickname:ye,avatar:""},stats:{likes:0,collects:0},cover:Q}}catch(Z){console.error("Parse Error:",Z)}return null},A=t=>{if(!t||t.length<5)return"";let e=t.replace(/^(https?:)?\/\//,"");return e=e.replace(/^\/+/,""),`https://images.weserv.nl/?url=${encodeURIComponent(e)}&w=800&output=webp`},de=async()=>{if(m.noteurl)try{const t=await ce(m.noteurl);if(t){const e=ue(t);e?(i.value=e,h.value=A(e.cover),E.value=A(e.user.avatar),ve()):g.value=!0}else g.value=!0}catch(t){console.error(t),g.value=!0}finally{I.value=!1}},ve=()=>{if(!h.value)return;const t=new Image;t.crossOrigin="anonymous",t.src=h.value,t.onload=()=>{try{const e=document.createElement("canvas"),n=e.getContext("2d");e.width=1,e.height=1,n.drawImage(t,0,0,1,1);const[a,r,_]=n.getImageData(0,0,1,1).data;D.value=`rgb(${a}, ${r}, ${_})`,N.value=`rgb(${255-a}, ${255-_}, ${255-r})`}catch{}}},M=t=>t==null?"":String(t).replace(/[&<>\"'`]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"})[e]),me=t=>{const e=new Set,n=new Set;return t?(t.replace(/@([A-Za-z0-9_\.\-\u4e00-\u9fff]{1,64})/g,(a,r)=>(e.add(r),a)),t.replace(/#([\p{L}0-9_\-\u4e00-\u9fff]{1,64})/gu,(a,r)=>(n.add(r),a)),{mentions:Array.from(e),tags:Array.from(n)}):{mentions:[],tags:[]}},pe=t=>{if(!t)return"";let e=M(t);return e=e.replace(/\r\n|\r|\n/g,"<br>"),e=e.replace(/@([A-Za-z0-9_\.\-\u4e00-\u9fff]{1,64})/g,(n,a)=>`<span class="mention-link">@${M(a)}</span>`),e=e.replace(/\[话题\]#/g,""),e=e.replace(/#([\p{L}0-9_\-\u4e00-\u9fff]{1,64})/gu,""),e=e.replace(/(<br>\s*){3,}/g,"<br><br>"),e},ge=w(()=>{var t;return pe(((t=i.value)==null?void 0:t.desc)||"")}),q=w(()=>{var t;return me(((t=i.value)==null?void 0:t.desc)||"")}),he=w(()=>i.value?[{label:"LIKES",val:$(i.value.stats.likes),icon:"♥"},{label:"FAVS",val:$(i.value.stats.collects),icon:"★"}]:[]);return be(()=>de()),(t,e)=>{var n;return v(),d("article",{class:xe(["xhs-embed-container",{"is-loading":I.value,"is-error":g.value,"is-hovering":f.value}]),ref_key:"cardRef",ref:S,onMousemove:ne,onMouseenter:oe,onMouseleave:re,style:x({"--theme-red":D.value,"--theme-accent":N.value})},[s("div",Ce,[s("div",{class:"bg-blur",style:x({backgroundImage:`url(${h.value||"https://images.weserv.nl/?url=ci.xiaohongshu.com/eb77b848-0c2d-4537-9755-667746404980"})`})},null,4),e[0]||(e[0]=s("div",{class:"noise-layer"},null,-1)),e[1]||(e[1]=s("div",{class:"red-wash"},null,-1))]),I.value?(v(),d("div",Te,e[2]||(e[2]=[s("div",{class:"skeleton-card",role:"status","aria-label":"loading"},[s("div",{class:"skeleton-media","aria-hidden":"true"}),s("div",{class:"skeleton-content"},[s("div",{class:"skeleton-header"},[s("div",{class:"skeleton-brand"}),s("div",{class:"skeleton-id"})]),s("div",{class:"skeleton-title"}),s("div",{class:"skeleton-lines"},[s("div",{class:"line short"}),s("div",{class:"line"}),s("div",{class:"line long"})]),s("div",{class:"skeleton-chips"},[s("div",{class:"chip"}),s("div",{class:"chip small"}),s("div",{class:"chip"})]),s("div",{class:"skeleton-footer"},[s("div",{class:"avatar"}),s("div",{class:"meta-lines"},[s("div",{class:"line tiny"})])])])],-1),s("div",{class:"red-loader small","aria-hidden":"true"},[s("span",{class:"dot"}),s("span",{class:"dot"}),s("span",{class:"dot"})],-1)]))):g.value?(v(),d("div",Ee,[e[3]||(e[3]=s("div",{class:"error-msg"},"CONNECTION_REFUSED",-1)),s("a",{href:m.noteurl,target:"_blank",class:"manual-link"},"OPEN_MANUAL",8,De)])):(v(),d("div",{key:2,class:"xhs-card",style:x(le.value)},[e[7]||(e[7]=s("div",{class:"card-glass-reflection"},null,-1)),s("a",{href:m.noteurl,target:"_blank",class:"media-area"},[s("div",$e,[s("div",{class:"media-layer",style:x({backgroundImage:`url(${h.value})`})},null,4),e[5]||(e[5]=s("div",{class:"media-vignette"},null,-1)),i.value.type==="video"?(v(),d("div",Ae,e[4]||(e[4]=[s("svg",{viewBox:"0 0 24 24",width:"12",height:"12",fill:"currentColor"},[s("path",{d:"M8 5v14l11-7z"})],-1),we(" VIDEO ")]))):ee("",!0)])],8,Ne),s("div",Me,[s("div",qe,[e[6]||(e[6]=s("span",{class:"brand-tag"},"RED.NOTE",-1)),s("span",Re,"#"+p(((n=ie(m.noteurl))==null?void 0:n.slice(-6))||"UNK"),1)]),s("h3",Fe,[s("a",{href:m.noteurl,target:"_blank"},p(i.value.title),9,Le)]),s("p",{class:"note-abstract",innerHTML:ge.value,"aria-label":i.value.desc},null,8,Ue),q.value.tags.length?(v(),d("div",Oe,[s("div",Be,[(v(!0),d(te,null,se(q.value.tags,a=>(v(),d("a",{key:"t-"+a,class:"tag-chip",href:`https://www.xiaohongshu.com/search/result?keyword=${encodeURIComponent("#"+a)}`,target:"_blank",rel:"noopener noreferrer","aria-label":"tag"},"#"+p(a),9,He))),128))])])):ee("",!0),s("div",Xe,[s("div",Pe,[s("img",{src:E.value||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3Crect width='1' height='1' fill='%23333'/%3E%3C/svg%3E",class:"user-avatar",crossorigin:"anonymous"},null,8,ze),s("span",Ve,p(i.value.user.nickname),1)]),s("div",Ye,[(v(!0),d(te,null,se(he.value,a=>(v(),d("div",{class:"stat-pill",key:a.label},[s("span",je,p(a.icon),1),s("span",Ge,p(a.val),1)]))),128))])])])],4))],38)}}},Qe=Se(Je,[["__scopeId","data-v-24915fcf"]]);export{Qe as default};
