import{r as d,v as X,f as Q,j as _,c as ee,o as c,w as te,b as r,l as w,e as l,E as ae,m as le,t as D,G as E,T as oe,n as z}from"./entry-index-DaJ121bm.js";import{_ as ne}from"./chunk-_plugin-vue_export-helper-DlAUqK2U.js";import"./chunk-mermaid-lib-Cmv1Qdle.js";const se=["src","alt"],ie=["innerHTML"],ue={class:"viewer-controls"},ce={class:"zoom-level"},re={key:0,class:"viewer-info"},ve={key:0,class:"drag-hint"},de={key:1,class:"viewer-info"},fe={key:0},b=.5,M=3,A=.25,me={__name:"ImageViewer",props:{visible:{type:Boolean,default:!1},imageSrc:{type:String,default:""},imageAlt:{type:String,default:""},imageType:{type:String,default:"img",validator:n=>["img","svg"].includes(n)},svgContent:{type:String,default:""}},emits:["update:visible","close"],setup(n,{emit:I}){const m=n,C=I,s=d(null),t=d(1),i=d(!1),v=d({x:0,y:0}),o=d({x:0,y:0}),g=d({x:0,y:0}),k=()=>{C("update:visible",!1),C("close"),y(),f()},S=()=>{t.value<M&&(t.value=Math.min(t.value+A,M),u(),p())},T=()=>{t.value>b&&(t.value=Math.max(t.value-A,b),u(),p(),t.value<=1&&f())},p=()=>{s.value&&(s.value.style.cursor=t.value>1?"grab":"default")},y=()=>{t.value=1,V()},f=()=>{o.value={x:0,y:0},g.value={x:0,y:0},u()},V=()=>{u()},u=()=>{if(s.value){const e=s.value.querySelector("img, .viewer-svg-container");e&&(e.style.transform=`translate(${o.value.x}px, ${o.value.y}px) scale(${t.value})`)}},R=e=>{t.value>1&&(i.value=!0,v.value={x:e.clientX-o.value.x,y:e.clientY-o.value.y},s.value&&(s.value.style.cursor="grabbing"),e.preventDefault())},N=e=>{i.value&&(o.value={x:e.clientX-v.value.x,y:e.clientY-v.value.y},u())},B=()=>{i.value&&(i.value=!1,g.value={...o.value},s.value&&(s.value.style.cursor=t.value>1?"grab":"default"))},$=()=>{i.value&&B()},H=e=>{if(t.value>1&&e.touches.length===1){i.value=!0;const a=e.touches[0];v.value={x:a.clientX-o.value.x,y:a.clientY-o.value.y},e.preventDefault()}},U=e=>{if(!i.value||e.touches.length!==1)return;const a=e.touches[0];o.value={x:a.clientX-v.value.x,y:a.clientY-v.value.y},u(),e.preventDefault()},W=()=>{i.value&&(i.value=!1,g.value={...o.value})},j=e=>{e.preventDefault();const G=(e.deltaY>0?-1:1)*.1,x=Math.max(b,Math.min(M,t.value+G));if(x===t.value)return;const h=s.value.getBoundingClientRect(),K=e.clientX-h.left,O=e.clientY-h.top,P=h.width/2,Z=h.height/2,F=K-P,J=O-Z,Y=x/t.value;o.value={x:o.value.x-F*(Y-1),y:o.value.y-J*(Y-1)},t.value=x,u(),p(),g.value={...o.value},t.value<=1&&f()},q=()=>{},L=e=>{if(m.visible)switch(e.key){case"Escape":k();break;case"+":case"=":S();break;case"-":T();break;case"0":y();break}};return X(()=>m.visible,e=>{e?(document.body.style.overflow="hidden",t.value=1,f(),z(()=>{u()})):(document.body.style.overflow="",y(),f())}),X(()=>m.svgContent,e=>{e&&m.visible&&z(()=>{u()})}),Q(()=>{window.addEventListener("keydown",L)}),_(()=>{window.removeEventListener("keydown",L),document.body.style.overflow=""}),(e,a)=>(c(),ee(oe,{name:"viewer-fade"},{default:te(()=>[n.visible?(c(),r("div",{key:0,class:"image-viewer-overlay",onClick:k},[l("div",{class:"image-viewer-container",onClick:a[0]||(a[0]=ae(()=>{},["stop"]))},[l("button",{class:"viewer-close-btn",onClick:k,title:"关闭 (ESC)"},a[1]||(a[1]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])),l("div",{class:"viewer-content",ref_key:"contentRef",ref:s,onMousedown:R,onMousemove:N,onMouseup:B,onMouseleave:$,onWheel:j,onTouchstart:H,onTouchmove:U,onTouchend:W,style:le({cursor:t.value>1?i.value?"grabbing":"grab":"default"})},[n.imageType==="img"?(c(),r("img",{key:0,src:n.imageSrc,alt:n.imageAlt,class:"viewer-image",onLoad:q,draggable:"false"},null,40,se)):n.imageType==="svg"?(c(),r("div",{key:1,class:"viewer-svg-container",innerHTML:n.svgContent},null,8,ie)):w("",!0)],36),l("div",ue,[l("button",{onClick:T,title:"缩小 (-)"},a[2]||(a[2]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("circle",{cx:"11",cy:"11",r:"8"}),l("path",{d:"M21 21l-4.35-4.35M8 11h6"})],-1)])),l("span",ce,D(Math.round(t.value*100))+"%",1),l("button",{onClick:S,title:"放大 (+)"},a[3]||(a[3]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("circle",{cx:"11",cy:"11",r:"8"}),l("path",{d:"M21 21l-4.35-4.35M11 8v6M8 11h6"})],-1)])),l("button",{onClick:y,title:"重置 (0)"},a[4]||(a[4]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),l("path",{d:"M3 3v5h5"})],-1)]))]),n.imageAlt?(c(),r("div",re,[E(D(n.imageAlt)+" ",1),t.value>1?(c(),r("span",ve," • 可拖动")):w("",!0),a[5]||(a[5]=l("span",{class:"scroll-hint"}," • 滚轮缩放",-1))])):(c(),r("div",de,[t.value>1?(c(),r("span",fe,"可拖动查看 • ")):w("",!0),a[6]||(a[6]=E("滚轮缩放 "))]))])])):w("",!0)]),_:1}))}},we=ne(me,[["__scopeId","data-v-c2ffcddb"]]);export{we as default};
